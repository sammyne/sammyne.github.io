(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{751:function(t,e,a){"use strict";a.r(e);var r=a(2),_=Object(r.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("Trusted Board Boot（简写 TBB）特性验证从启动直至常规世界引导器在内的固件镜像（TEE OS 是其中固件之一），防止平台运行恶意固件。具体是通过建立 PKCS 形式的信任链实现的。")]),t._v(" "),e("p",[t._v("本文介绍 Trusted Firmware-A（TF-A）的 TBB。这是 Arm DEN0006D 的 "),e("a",{attrs:{href:"https://developer.arm.com/docs/den0006/latest/trusted-board-boot-requirements-client-tbbr-client-armv8-a",target:"_blank",rel:"noopener noreferrer"}},[t._v("Trusted Board Boot Requirements (TBBR)"),e("OutboundLink")],1),t._v(" 规格文档的一个实现。本文应与实现 TBBR 指定部分的 "),e("a",{attrs:{href:"https://trustedfirmware-a.readthedocs.io/en/latest/components/firmware-update.html#firmware-update-fwu",target:"_blank",rel:"noopener noreferrer"}},[t._v("Firmware Update (FWU)"),e("OutboundLink")],1),t._v(" 设计文档一起使用。")]),t._v(" "),e("h2",{attrs:{id:"_1-信任链"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-信任链"}},[t._v("#")]),t._v(" 1. 信任链")]),t._v(" "),e("p",[t._v("信任链（Chain of Trust，简写为 CoT）起源于隐式的可信组件。对于 Arm 开发平台，这些组件如下")]),t._v(" "),e("ul",[e("li",[t._v("可信根公钥（Root of Trust Public Key，简写为 ROTPK）的 SHA-256 哈希。这个公钥存储再可信的根密钥寄存器。另外，也可以使用开发版的 ROTPK，将其哈希嵌入到 BL1 和 BL2 镜像（只适用于开发用途）。")]),t._v(" "),e("li",[t._v("假设 BL1 镜像存在于 ROM，无法被篡改。")])]),t._v(" "),e("p",[t._v("CoT 的其余组件是证书和引导器镜像。证书遵循 "),e("a",{attrs:{href:"https://tools.ietf.org/rfc/rfc5280.txt",target:"_blank",rel:"noopener noreferrer"}},[t._v("X.509 v3"),e("OutboundLink")],1),t._v(" 标准。本文的标准往证书添加自定义的拓展字段，用于存储建立 CoT 的必要信息。")]),t._v(" "),e("p",[t._v("TBB CoT 的所有证书都自签名的。因为 CoT 借助证书拓展字段的内容而不是验证证书颁发者的合法性建立起来的，所以不需要证书颁发机构（CA）。证书的签发支持多种签名方案。")]),t._v(" "),e("p",[t._v("证书具体分为"),e("strong",[t._v("密钥")]),t._v("和"),e("strong",[t._v("内容")]),t._v("证书两类。密钥证书用于验证签发内容证书的公钥。内容证书用于存储引导程序镜像的哈希。镜像的鉴权要求其哈希与内容证书注明的哈希匹配。平台支持多种哈希算法。公钥和哈希包含在 "),e("a",{attrs:{href:"https://tools.ietf.org/rfc/rfc5280.txt",target:"_blank",rel:"noopener noreferrer"}},[t._v("X.509 v3"),e("OutboundLink")],1),t._v(" 证书的非标准拓展字段。")]),t._v(" "),e("p",[t._v("建立 CoT 的密钥如下")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"right"}},[t._v("密钥")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"right"}},[t._v("可信根密钥对")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("私钥签发 BL2 的内容证书和可信密钥证书。其公钥为 ROTPK")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"right"}},[t._v("可信世界密钥对")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("私钥签发验证安全世界镜像（SCP_BL2、BL31 和 BL32）的密钥证书。公钥存在可信世界证书的某个拓展字段")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"right"}},[t._v("非可信世界密钥对")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("私钥签发验证非安全世界镜像（BL33）的密钥证书。公钥存在可信世界证书的某个拓展字段")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"right"}},[t._v("BL3X 密钥对")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("对于 SCP_BL2、BL31、BL32 和 BL33，私钥用于签发 BL3X 镜像的内容证书。公钥存在对应密钥证书的拓展字段")])])])]),t._v(" "),e("p",[t._v("CoT 涉及的镜像如下")]),t._v(" "),e("ul",[e("li",[t._v("BL1")]),t._v(" "),e("li",[t._v("BL2")]),t._v(" "),e("li",[t._v("SCP_BL2（可选）")]),t._v(" "),e("li",[t._v("BL31")]),t._v(" "),e("li",[t._v("BL33")]),t._v(" "),e("li",[t._v("BL32（可选）")])]),t._v(" "),e("p",[t._v("验证镜像的相关证书如下")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"right"}},[t._v("证书")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"right"}},[t._v("BL2 内容证书")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("用 ROT 私钥自签名的证书，包含 BL2 镜像的哈希")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"right"}},[t._v("可信密钥证书")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("用 ROT 私钥自签名的证书，包含可信世界和非可信世界密钥对的公钥部分")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"right"}},[t._v("SCP_BL2 密钥证书")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("用可信世界私钥自签名的证书，包含 SCP_BL2 密钥对的公钥部分")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"right"}},[t._v("SCP_BL2 内容证书")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("用 SCP_BL2 密钥证书的私钥自签名的证书，包含 SCP_BL2 镜像的哈希")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"right"}},[t._v("BL31 密钥证书")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("用可信世界私钥自签名的证书，包含 BL31 密钥对的公钥部分")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"right"}},[t._v("BL31 内容证书")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("用 BL31 密钥证书的私钥自签名的证书，包含 BL31 镜像的哈希")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"right"}},[t._v("BL32 密钥证书")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("用可信世界私钥自签名的证书，包含 BL32 密钥对的公钥部分")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"right"}},[t._v("BL32 内容证书")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("用 BL32 密钥证书的私钥自签名的证书，包含 BL32 镜像的哈希")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"right"}},[t._v("BL33 密钥证书")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("用非可信世界私钥自签名的证书，包含 BL33 密钥对的公钥部分")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"right"}},[t._v("BL33 内容证书")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("用 BL33 密钥证书的私钥自签名的证书，包含 BL33 镜像的哈希")])])])]),t._v(" "),e("p",[t._v("SCP_BL2 和 BL32 证书是非必须的，但对应的 SCP_BL2 或 BL32 存在时必须存在。")]),t._v(" "),e("p",[t._v("信任链结构关系大致如下")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("                                        +-------+\n                    +-------------------+ ROTPK +--------------------+\n                    |                   +-------+                    |\n                    |                                                |\n                    |                                                |\n                    v                                                v\n          +---------+--------+                            +----------+-------+\n          | BL2 Content Cert |         +------------------+ Trusted Key Cert +----------------------+\n          +------------------+         |                  +------------------+                      |\n                                       |                                                            |\n                                       |                                                            |\n                                       v                                                            v\n                        +--------------+---------+                                    +-------------+--------------+\n            +-----------+ Trusted World Key Cert +------------+                       | Non|trusted World Key Cert |\n            |           +------------+-----------+            |                       +-------------+--------------+\n            |                        |                        |                                     |\n            |                        |                        |                                     |\n            v                        v                        v                                     v\n+-----------+----------+   +---------+----------+   +---------+---------+                  +--------+----------+\n| SCP_BL2 Content Cert |   | BL31 Content Cert  |   | BL32 Content Cert |                  | BL33 Content Cert |\n+----------------------+   +--------------------+   +-------------------+                  +-------------------+\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br"),e("span",{staticClass:"line-number"},[t._v("20")]),e("br"),e("span",{staticClass:"line-number"},[t._v("21")]),e("br")])]),e("h2",{attrs:{id:"_2-tbb-启动流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-tbb-启动流程"}},[t._v("#")]),t._v(" 2. TBB 启动流程")]),t._v(" "),e("p",[t._v("CoT 按照以下流程验证。其中任何步骤失败都会触发系统异常。")]),t._v(" "),e("ul",[e("li",[t._v("BL1 加载并验证 BL2 的内容证书。颁发者的公钥从已验证的密钥证书读取，其哈希和可信根密钥寄存器的值比对。如果匹配，则从证书读取 BL2 的哈希。\n"),e("blockquote",[e("p",[t._v("比对操作依平台而定，目前在 Arm 开发平台上没有实现。")])])]),t._v(" "),e("li",[t._v("BL1 加载 BL2 镜像。计算镜像哈希，并和证书读取的哈希比对。配对成功后，控制权转移到 BL2 镜像。")]),t._v(" "),e("li",[t._v("BL2 加载并验证可信密钥证书。颁发者的公钥从已验证的密钥证书读取，其哈希和可信根密钥寄存器的值比对。如果配对成功，BL2 读取并保存已验证证书注明的可信和非可信世界公钥。")])]),t._v(" "),e("p",[t._v("以下两步会为 SCP_BL2、BL31 和 BL32 镜像执行。如果 SCP_BL2 或 BL32 镜像不存在，则跳过响应的执行流程。")]),t._v(" "),e("ul",[e("li",[t._v("BL2 加载并验证 BL3x 的密钥证书。证书的签名用可信世界公钥验证。如果签名验证成功，BL2 读取并保存证书注明的 BL3x 公钥。")]),t._v(" "),e("li",[t._v("BL2 加载并验证 BL3x 的内容证书。证书的签名用可信世界公钥验证。如果签名验证成功，BL2 读取并保存证书注明的 BL3x 镜像哈希。")])]),t._v(" "),e("p",[t._v("以下两步只对 BL33 镜像执行。")]),t._v(" "),e("ul",[e("li",[t._v("BL2 加载并验证 BL33 的密钥证书。证书的签名用非可信世界公钥验证。如果签名验证成功，BL2 读取并保存证书注明的 BL3x 公钥。")]),t._v(" "),e("li",[t._v("BL2 加载并验证 BL33 的内容证书。证书的签名用非可信世界公钥验证。如果签名验证成功，BL2 读取并保存证书注明的 BL33 镜像哈希。")])]),t._v(" "),e("p",[t._v("以下步骤适用于所有引导程序镜像。")]),t._v(" "),e("ul",[e("li",[t._v("BL2 计算每个镜像的哈希，将其与内容证书注明的哈希比对。哈希匹配说明镜像验证成功。")])]),t._v(" "),e("h2",{attrs:{id:"参考文献"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考文献"}},[t._v("#")]),t._v(" 参考文献")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://trustedfirmware-a.readthedocs.io/en/v2.4/design/trusted-board-boot.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Trusted Board Boot"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=_.exports}}]);