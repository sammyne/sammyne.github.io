(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{610:function(s,t,a){s.exports=a.p+"assets/img/illustration.39095e94.jpg"},611:function(s,t,a){s.exports=a.p+"assets/img/json-benchstat-throttling.dd78ad2d.png"},612:function(s,t,a){s.exports=a.p+"assets/img/json-perflock.2b3000c6.png"},652:function(s,t,a){"use strict";a.r(t);var n=a(6),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("blockquote",[n("p",[s._v("åŸæ–‡ï¼š"),n("a",{attrs:{href:"https://about.sourcegraph.com/go/gophercon-2019-optimizing-go-code-without-a-blindfold?utm_source=hs_email&utm_medium=email&utm_content=75138236&_hsenc=p2ANqtz--NgfSL80JgQDQ5zlr3v6AQmsSI149ot4H7UuBdOvbfawqznjkfU7-fXFNbZ3-aZabzoJ7VKB6tCG9BjG21uiDA5_1Kz1nhO5aUV5PiHggYz3MBTEg&_hsmi=75138236",target:"_blank",rel:"noopener noreferrer"}},[s._v("GopherCon 2019 - Optimizing Go Code without a blindfold"),n("OutboundLink")],1)])]),s._v(" "),n("img",{attrs:{src:a(610),width:"800px",alt:"Illustration by Sketch Post"}}),s._v(" "),n("blockquote",[n("p",[s._v("è¯‘è€…é‡‡ç”¨çš„goç‰ˆæœ¬ä¸º1.12.5")])]),s._v(" "),n("h2",{attrs:{id:"æ¦‚è§ˆ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æ¦‚è§ˆ"}},[s._v("#")]),s._v(" æ¦‚è§ˆ")]),s._v(" "),n("p",[s._v("äººäººéƒ½æƒ³ç¨‹åºè·‘å¾—æ›´å¿«ï¼Œè€Œè¿™ä¸ªç›®æ ‡å€ŸåŠ©Goçš„æ€§èƒ½æµ‹è¯•æ˜¯å¾ˆå®¹æ˜“å®ç°çš„ã€‚ä¼˜åŒ–ç¨‹åºå¯èƒ½ä¼šç›¸å½“å¤æ‚ï¼Œéœ€è¦è€—è´¹ç²¾åŠ›ä»”ç»†æ–Ÿé…Œæ­£ç¡®çš„å§¿åŠ¿ã€‚æœ¬æ–‡å°†ä¼šå±•ç¤ºä¸šä½™çš„æ€§èƒ½ä¼˜åŒ–è€…æ‰€å¿…é¡»çš„æŠ€å·§å’Œå·¥å…·ã€‚")]),s._v(" "),n("h2",{attrs:{id:"goæ€§èƒ½æµ‹è¯•"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#goæ€§èƒ½æµ‹è¯•"}},[s._v("#")]),s._v(" Goæ€§èƒ½æµ‹è¯•")]),s._v(" "),n("p",[s._v("ä½ æ˜¯å¦æƒ³çŸ¥é“æ€ä¹ˆç¡®å®šä½ çš„ä»£ç æ˜¯å¦æ…¢ï¼Ÿå®ƒèƒ½å¦è·‘å¾—æ›´å¿«ï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œä½ ä¸Šæ‰‹çš„ç¬¬ä¸€ä»¶å·¥å…·åº”è¯¥æ˜¯æ€§èƒ½æµ‹è¯•ã€‚")]),s._v(" "),n("p",[s._v("Goçš„æ ‡å‡†åº“"),n("code",[s._v("testing")]),s._v("æœ‰ç”¨äºæµ‹é‡ä»£ç çš„CPUå’Œå†…å­˜æ¶ˆè€—çš„å·¥å…·ã€‚çœ‹ä¸ªç®€å•ä¾‹å­")]),s._v(" "),n("div",{staticClass:"language-go line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("copyList")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("in "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" out "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("_")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("range")]),s._v(" in "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tout "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" out\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("æ€§èƒ½æµ‹è¯•ä»£ç å¦‚ä¸‹")]),s._v(" "),n("div",{staticClass:"language-go line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("BenchmarkCopyList")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("b "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("testing"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ReportAllocs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("N"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("copyList")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("input"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("å¯åŠ¨æµ‹è¯•å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼Œç”±è¾“å‡ºå¯çŸ¥ï¼šè¿™ä¸ªç®€å•å‡½æ•°æ¯æ¬¡è°ƒç”¨å¤§çº¦è€—è´¹244nsï¼Œé™„å¸¦ä¸å°‘å†…å­˜åˆ†é…ã€‚")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("go "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -bench"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(".\nBenchmarkCopyList-4   \t "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000000")]),s._v("\t       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("244")]),s._v(" ns/op\t     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("240")]),s._v(" B/op\t       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" allocs/op\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("èƒ½ä¼˜åŒ–å—ï¼Ÿå¯ä»¥å€ŸåŠ©"),n("a",{attrs:{href:"https://golang.org/pkg/runtime/pprof/",target:"_blank",rel:"noopener noreferrer"}},[s._v("pprof"),n("OutboundLink")],1),s._v("å·¥å…·æŸ¥çœ‹å“ªè¡Œä»£ç æ¯”è¾ƒè€—æ—¶ï¼š")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("go "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -cpuprofile"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cpu.out -bench"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(".\n\ngo tool pprof cpu.out\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¾“å‡º")]),s._v("\nType: cpu\nTime: Aug "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(", "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v(" at "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":50pm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nDuration: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".63s, Total samples "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".52s "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("93.09")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nEntering interactive mode "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"help"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" commands, "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"o"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pprof"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" list copyList\nTotal: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".52s\nROUTINE "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" code.copyList "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /xxxx/code/demo.go\n      60ms      560ms "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("flat, cum"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("36.84")]),s._v("% of Total\n         "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":package code\n         "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(":\n         "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":func copyList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("in "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("string "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(":\tvar out "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("string\n      10ms       10ms      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(":\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" _, s :"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" range "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      50ms      550ms      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(":\t\tout "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" append"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("out, s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n         "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(":\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n         "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":\n         "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(":\t"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" out\n         "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("p",[s._v("ç”±ä¸Šå¯çŸ¥ï¼Œå¤§éƒ¨åˆ†æ—¶é—´éƒ½ç”¨åœ¨"),n("code",[s._v("append")]),s._v("æ“ä½œä¸Šé¢äº†ï¼å¥½åœ¨é€šè¿‡é¢„åˆ†é…åˆ‡ç‰‡ç„¶åç»™æ¯ä¸ªå…ƒç´ èµ‹å€¼çš„æ–¹å¼æ¥ç®€å•ä¿®æ­£ã€‚")]),s._v(" "),n("div",{staticClass:"language-go line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("copyList")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("in "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tout "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("len")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("in"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("range")]),s._v(" in "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" s\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" out\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("çœ‹ä¸€ä¸‹æ€§èƒ½æå‡ç¨‹åº¦ï¼Œè¿™æ—¶éœ€è¦"),n("a",{attrs:{href:"https://github.com/golang/tools/tree/master/cmd/benchcmp",target:"_blank",rel:"noopener noreferrer"}},[s._v("benchcmp"),n("OutboundLink")],1),s._v("å·¥å…·--å±•ç¤ºåŒä¸€ä¸ªæ€§èƒ½æµ‹è¯•ä¸¤æ¬¡æ‰§è¡Œç»“æœçš„æ€§èƒ½å˜åŒ–ï¼š")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("go get -u -v golang.org/x/tools/cmd/benchcmp\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# with the copyList from code/demo.go")]),s._v("\ngo "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -bench"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(". "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" old.txt\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# with the copyList from code/demo_optimized.go")]),s._v("\ngo "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -bench"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(". "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" new.txt\n\nbenchcmp old.txt new.txt\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¯¹æ¯”ç»“æœå¦‚ä¸‹")]),s._v("\nbenchmark               old ns/op     new ns/op     delta\nBenchmarkCopyList-4     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("237")]),s._v("           "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("67.8")]),s._v("          -71.39%\n\nbenchmark               old allocs     new allocs     delta\nBenchmarkCopyList-4     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("              "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("              -75.00%\n\nbenchmark               old bytes     new bytes     delta\nBenchmarkCopyList-4     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("240")]),s._v("           "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("96")]),s._v("            -60.00%\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("ğŸ‰ å“‡!!ğŸ‰ æ€§èƒ½é£™å‡ä¸å°‘å‘ã€‚")]),s._v(" "),n("h2",{attrs:{id:"ä½†æ˜¯-æ€§èƒ½æµ‹è¯•ä¿¡å¾—è¿‡å—"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä½†æ˜¯-æ€§èƒ½æµ‹è¯•ä¿¡å¾—è¿‡å—"}},[s._v("#")]),s._v(" ä½†æ˜¯ï¼Œæ€§èƒ½æµ‹è¯•ä¿¡å¾—è¿‡å—ï¼Ÿ")]),s._v(" "),n("p",[s._v("ä¸Šä¸€èŠ‚çš„ä¾‹å­ç®€å•äº†ç‚¹ï¼Œç°å®éœ€è¦æ€§èƒ½æµ‹è¯•çš„ç”Ÿäº§çº§ä»£ç å¾€å¾€è¦å¤æ‚å¾—å¤šã€‚è®©æˆ‘ä»¬è½¬åˆ°æ ‡å‡†åº“çš„"),n("a",{attrs:{href:"https://golang.org/pkg/encoding/json/",target:"_blank",rel:"noopener noreferrer"}},[s._v("encoding/json"),n("OutboundLink")],1),s._v(" åŒ…çœ‹ä¸ªèµ„æºå¯†é›†å‹çš„ä¾‹å­ã€‚èŒƒå›´ç¡®å®šä¸€ä¸‹ï¼Œå°±æ˜¯ "),n("a",{attrs:{href:"https://github.com/golang/go/blob/919594830f17f25c9e971934d825615463ad8a10/src/encoding/json/bench_test.go#L148-L171",target:"_blank",rel:"noopener noreferrer"}},[s._v("BenchmarkCodeDecoder"),n("OutboundLink")],1),s._v(" æµ‹è¯•.")]),s._v(" "),n("p",[s._v("ç¨å¾®è·‘å¤šå‡ æ¬¡çš„è¯ï¼Œä½ ä¼šå‘ç°æ€§èƒ½æµ‹åº¦æ¯æ¬¡éƒ½æœ‰æ‰€ä¸åŒï¼š")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GOROOT")]),s._v("/src/encoding/json\n\ngo "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -bench"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("CodeDecoder\ngo "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -bench"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("CodeDecoder\ngo "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -bench"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("CodeDecoder\ngo "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -bench"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("CodeDecoder\ngo "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -bench"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("CodeDecoder\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç»“æœå¯¹æ¯”å¦‚ä¸‹")]),s._v("\nBenchmarkCodeDecoder-4   \t     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\t  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19056070")]),s._v(" ns/op\t "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("101.83")]),s._v(" MB/s\nBenchmarkCodeDecoder-4   \t     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\t  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19120626")]),s._v(" ns/op\t "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("101.49")]),s._v(" MB/s\nBenchmarkCodeDecoder-4   \t     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\t  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18875387")]),s._v(" ns/op\t "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("102.80")]),s._v(" MB/s\nBenchmarkCodeDecoder-4   \t     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\t  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20058788")]),s._v(" ns/op\t  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("96.74")]),s._v(" MB/s\nBenchmarkCodeDecoder-4   \t     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\t  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20389545")]),s._v(" ns/op\t  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("95.17")]),s._v(" MB/s\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("+/-3%çš„å˜åŠ¨çœ‹èµ·æ¥ä¸å€¼å¾—è®©æˆ‘ä»¬å¤±çœ ï¼Œåƒ"),n("code",[s._v("encoding/json")]),s._v("è¿™æ ·çš„åŒ…é€šå¸¸ä¼šç¨æœ‰åŠ é€Ÿ--äº‹å®ä¸Šï¼Œ"),n("code",[s._v("encoding/json")]),s._v("çš„æœ€æ–°4æ¬¡æ€§èƒ½æå‡éƒ½å°äº4%ã€‚å¹²æ‰°å› ç´ çº·ç¹å¤æ‚ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•ç¡®å®šä¸€æ¬¡å˜åŠ¨æ˜¯å¦çœŸæ­£åœ°å½±å“äº†ä¸€ä¸ªåŒ…çš„æ€§èƒ½å‘¢ï¼Ÿ")]),s._v(" "),n("p",[s._v("è¿™æ—¶å°±å¾—æ•°æ®è¯´è¯äº†ã€‚")]),s._v(" "),n("h2",{attrs:{id:"æ€§èƒ½æµ‹è¯•-çš„æ•°æ®"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æ€§èƒ½æµ‹è¯•-çš„æ•°æ®"}},[s._v("#")]),s._v(" æ€§èƒ½æµ‹è¯• â¤ï¸ çš„æ•°æ®")]),s._v(" "),n("p",[s._v("ä¸ºäº†ç†è§£æŸä¸ªåŒ…çš„çœŸæ­£æ€§èƒ½ç‰¹å¾ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šçœ‹æ€§èƒ½æµ‹è¯•å¤šæ¬¡è¿è¡Œçš„ç»“æœï¼Œç„¶åè®¡ç®—ä¸­ä½æ•°å’Œæ–¹å·®ã€‚è¿™æ—¶å¯ä»¥ç”¨åˆ°"),n("a",{attrs:{href:"https://godoc.org/golang.org/x/perf/cmd/benchstat",target:"_blank",rel:"noopener noreferrer"}},[s._v("benchstat"),n("OutboundLink")],1),s._v("å‘½ä»¤ï¼š")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("go get -u -v golang.org/x/perf/cmd/benchstat\n\ngo "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -bench"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("CodeDecoder -count"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ~/old.txt\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ç»“æœå¦‚ä¸‹")]),s._v("\nname           time/op\nCodeDecoder-4    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(".7ms Â±18%\n\nname           speed\nCodeDecoder-4  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v(".5MB/s Â±16%\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("16%çš„æ–¹å·®ä»ç„¶æ˜¯ç›¸å½“é«˜çš„ã€‚è¦é™ä½å®ƒçš„è¯ï¼Œæˆ‘ä»¬å¾—çœ‹çœ‹CPUè¿˜å¹²äº†å•¥ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæ€§èƒ½æµ‹è¯•ä¼šæ„‰å¿«åœ°æ‹¼å‘½å ç”¨CPUï¼Œå› æ­¤CPUä¼šå°½å¯èƒ½åœ°è¢«å®ƒå‹æ¦¨åˆ°0%ã€‚ä½†äº‹å®æ˜¯ï¼Œä½ å¯èƒ½æ‰‹å¤´æ‰“å¼€äº†Slackã€ç¼–è¾‘å™¨è¿˜æœ‰20å¤šä¸ªChromeæ ‡ç­¾é¡µã€‚ï¼ˆæœ‰è¶£äº‹å®ï¼š"),n("a",{attrs:{href:"https://news.ycombinator.com/item?id=14087899",target:"_blank",rel:"noopener noreferrer"}},[s._v("Slackä¸­çš„åŠ¨æ€è¡¨æƒ…é€šå¸¸æ¶ˆè€—å¤§é‡CPU"),n("OutboundLink")],1),s._v("ï¼‰")]),s._v(" "),n("p",[s._v("å…³æ‰è¿™äº›èµ„æºè´ªå¿ƒå‹åº”ç”¨è¶³å¤ŸæŠŠæˆ‘ä»¬çš„æ–¹å·®é™åˆ°+/-5%ã€‚")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("go "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -bench"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("CodeDecoder -count"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ~/new.txt\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ–°ç»“æœå¦‚ä¸‹")]),s._v("\nname           time/op\nCodeDecoder-4   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(".7ms Â± "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("%\n\nname           speed\nCodeDecoder-4  104MB/s Â± "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("%\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("ç„¶åï¼ŒCPU\bçš„é—®é¢˜è¿˜ä¸è‡³äºæ­¤ã€‚ä¸€æ¬¡æ€§è¿è¡Œå¤šæ¬¡æ€§èƒ½æµ‹è¯•ï¼Œä¼šå‘ç°æ€§èƒ½å› ä¸æ˜åŸå› æ˜æ˜¾ä¸‹é™ã€‚")]),s._v(" "),n("img",{attrs:{src:a(611),width:"800px",alt:"json-benchstat-throttling"}}),s._v(" "),n("blockquote",[n("p",[s._v("è¯‘è€…æ³¨ï¼šä¸Šè¿°ç°è±¡åœ¨æœ¬äººç”µè„‘ä¸Šå¹¶ä¸æ˜æ˜¾")])]),s._v(" "),n("p",[s._v("è¿™ç§æƒ…å†µæ˜¯å› ä¸ºä¸Šè¿°æ€§èƒ½æµ‹è¯•100%å ç”¨CPUå¤ªä¹…è§¦å‘CPUé™é¢‘äº†ã€‚å¥½åœ¨æœ‰å¦ä¸€ä¸ªå·¥å…·--"),n("a",{attrs:{href:"https://github.com/aclements/perflock",target:"_blank",rel:"noopener noreferrer"}},[s._v("perflock"),n("OutboundLink")],1),s._v(" -- ç”¨äºé˜²æ­¢æ€§èƒ½æµ‹è¯•ä¸€ä¸‹å­å ç”¨å¤ªå¤šCPUï¼š")]),s._v(" "),n("img",{attrs:{src:a(612),width:"800px",alt:"json-perflock"}}),s._v(" "),n("p",[s._v("ä¸Šè¿°ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é™å®šæ€§èƒ½æµ‹è¯•çš„CPUåˆ©ç”¨ç‡ä¸ºä¸è¶…è¿‡70%ï¼Œè¶³ä»¥é˜²æ­¢ç”µè„‘é™ä½CPUçš„é¢‘ç‡äº†ã€‚")]),s._v(" "),n("p",[n("code",[s._v("benchstat")]),s._v("å¯åˆ†æå¤šæ¬¡æ€§èƒ½æµ‹è¯•ç„¶åè®¡ç®—ä¸­ä½æ•°å’Œæ–¹å·®ï¼Œè¿˜å¯ä»¥ç”¨äºå¸®åŠ©ç†è§£æŸæ¬¡ä»£ç å˜æ›´å¯¹æ€§èƒ½çš„å½±å“ã€‚çœ‹ä¸ªä¾‹å­ï¼š")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("go "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -bench"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("CodeDecoder -count"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ~/old.txt  \ngo "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -bench"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("CodeDecoder -count"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ~/new.txt  \n\nbenchstat ~/old.txt ~/new.txt\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¾“å‡º")]),s._v("\nname           old time/op    new time/op    delta\nCodeDecoder-4    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(".0ms Â±16%    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(".0ms Â± "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("%   ~     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("p"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.798")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("n")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("+8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nname           old speed      new speed      delta\nCodeDecoder-4  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("92")]),s._v(".9MB/s Â±14%  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("92")]),s._v(".7MB/s Â± "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("%   ~     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("p"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.776")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("n")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("+8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("å¯è§ï¼Œæ–°ä»£ç å¹³å‡æƒ…å†µä¸‹è¿è¡Œéœ€è¦21.0ms vs 21.0ms... å—¯ï¼Ÿ\nå¥½åœ¨"),n("code",[s._v("benchstat")]),s._v("åœ¨åº•éƒ¨æä¾›ä¸Šä¸‹æ–‡æ•°æ®å¸®åŠ©æˆ‘ä»¬ç†è§£ä¼˜åŒ–æ˜¯å¦æœ‰æ˜æ˜¾çš„æ•°æ®æå‡ã€‚å¯¹æ¯”ä¸¤æ¬¡æ€§èƒ½æµ‹è¯•ï¼Œæˆ‘ä»¬é€šå¸¸çœ‹åˆ°çš„æ˜¯"),n("code",[s._v("+/-X.XX%")]),s._v("è€Œä¸æ˜¯"),n("code",[s._v("~")]),s._v("å½¢å¼çš„å˜åŒ–ã€‚ç„¶åï¼Œå½“å‰æƒ…å½¢çš„é«˜"),n("code",[s._v("p")]),s._v("å€¼ï¼ˆ0.776ï¼‰è®©"),n("code",[s._v("benchstat")]),s._v("è£å®šæœ¬æ¬¡ä¼˜åŒ–æ•ˆæœä¸æ˜æ˜¾ã€‚è€Œä»€ä¹ˆæ˜¯"),n("code",[s._v("p")]),s._v("å€¼å‘¢ï¼Ÿå‡è®¾å˜æ›´å¯¹ä»£ç æ€§èƒ½æ²¡å½±å“ï¼ŒæŠŠ"),n("code",[s._v("p")]),s._v("å€¼çœ‹åš"),n("code",[s._v("benchstat")]),s._v("æŠ¥å‘Šè‡³å°‘å¦‚åˆšæ‰æ‰€è§èˆ¬æ€§èƒ½æå‡çš„æ¦‚ç‡ã€‚è¶Šä½çš„"),n("code",[s._v("p")]),s._v("å€¼æ„å‘³ç€"),n("code",[s._v("benchstat")]),s._v("å‘ç°çš„æ€§èƒ½æå‡åœ¨æ²¡æœ‰æ˜¾è‘—ä¼˜åŒ–æ—¶çš„å‘ç”Ÿæ¦‚ç‡æ˜¯è¶Šä½çš„ï¼Œå› æ­¤"),n("code",[s._v("p")]),s._v("å€¼è¶Šä½è¶Šå¥½ã€‚")]),s._v(" "),n("blockquote",[n("p",[s._v("è¯‘è€…æ³¨ï¼šè¿™ä¸ªæµ‹è¯•åœ¨æœ¬äººç”µè„‘ä¸Šä¹Ÿä¸å‡†")])]),s._v(" "),n("p",[s._v("å†æ¥ä¸ªæƒŠå–œ--å…¶å®ä¸Šé¢æ˜¯åŒä¸€ä»½ä»£ç çš„ä¸¤æ¬¡æ‰§è¡Œï¼"),n("code",[s._v("p=0.776")]),s._v("æ˜¯ç›¸å½“ç³Ÿç³•çš„ã€‚é€šå¸¸"),n("code",[s._v("p<=0.05")]),s._v("æ‰æ„å‘³ç€ä¸€æ¬¡ä¼˜åŒ–æ˜¯æ˜¾è‘—çš„ã€‚")]),s._v(" "),n("h2",{attrs:{id:"æ€§èƒ½æµ‹è¯•å°ç»“"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æ€§èƒ½æµ‹è¯•å°ç»“"}},[s._v("#")]),s._v(" æ€§èƒ½æµ‹è¯•å°ç»“")]),s._v(" "),n("p",[s._v("ç†è§£ä¸Šè¿°å†…å®¹åï¼Œæˆ‘ä»¬ç°åœ¨å°±å¯ä»¥ç¼–å†™æ€§èƒ½æµ‹è¯•ï¼Œç”¨"),n("code",[s._v("benchstat")]),s._v("æ¥æ£€æµ‹ä»£ç çš„æ€§èƒ½ï¼Œç„¶åç”¨"),n("code",[s._v("pprof")]),s._v("å‘æ˜æ½œåœ¨ä¼˜åŒ–ç‚¹ï¼Œä¸”åŸºäº"),n("code",[s._v("perlock")]),s._v("+"),n("code",[s._v("benchstat")]),s._v("æµ‹è¯•å®ƒä»¬ã€‚")]),s._v(" "),n("h2",{attrs:{id:"å†çœ‹çœ‹-ç¼–è¯‘å™¨ä¼˜åŒ–"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#å†çœ‹çœ‹-ç¼–è¯‘å™¨ä¼˜åŒ–"}},[s._v("#")]),s._v(" å†çœ‹çœ‹ï¼šç¼–è¯‘å™¨ä¼˜åŒ–")]),s._v(" "),n("p",[s._v("æˆ‘ä»¬å¯èƒ½éƒ½å¬è¯´è¿‡"),n("a",{attrs:{href:"https://en.wikipedia.org/wiki/Moore%27s_law",target:"_blank",rel:"noopener noreferrer"}},[s._v("æ‘©å°”å®šå¾‹"),n("OutboundLink")],1),s._v("--è®¡ç®—èƒ½åŠ›ï¼ˆå³é›†ä½“ç®¡æ•°ç›®ï¼‰æ¯18ä¸ªæœˆä¼šç¿»ä¸€ç•ªã€‚ä½†"),n("a",{attrs:{href:"http://proebsting.cs.arizona.edu/law.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Proebstingå®šå¾‹"),n("OutboundLink")],1),s._v("å‘¢ï¼Ÿå®ƒæ¨æµ‹ç¼–è¯‘å™¨çš„è¿›æ­¥æ¯18å¹´ä¼šä½¿å¾—è®¡ç®—èƒ½åŠ›ç¿»ä¸€ç•ªã€‚å¬èµ·æ¥ç¨€æ¾å¹³å¸¸ï¼Œä½†æ˜¯è¿™æš—ç¤ºç€ç¼–è¯‘å™¨ä¹Ÿæ˜¯å¯ä»¥å¸¦æ¥æ˜¾è‘—æ€§èƒ½æå‡çš„å“Ÿï¼äº†è§£æ€§èƒ½æµ‹è¯•ä¸å°‘åï¼Œç°åœ¨è®©æˆ‘ä»¬ä¹ŸèŠä¸€èŠGoç¼–è¯‘å™¨ä¼˜åŒ–æ€§èƒ½çš„ä¸€äº›æ–¹å¼ã€‚")]),s._v(" "),n("p",[s._v("å­¦ä¹ ç¼–è¯‘å™¨çš„éªšæ“ä½œå‰ï¼Œå»ºè®®è¯»ä¸€ä¸‹"),n("a",{attrs:{href:"https://github.com/golang/go/blob/master/src/cmd/compile/README.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("cmd/compile"),n("OutboundLink")],1),s._v("çš„æ–‡æ¡£ä»¥å¯¹Golangçš„ç¼–è¯‘å™¨æœ‰ä¸ªå®è§‚çš„äº†è§£ã€‚")]),s._v(" "),n("h2",{attrs:{id:"å‡½æ•°å†…è”"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#å‡½æ•°å†…è”"}},[s._v("#")]),s._v(" å‡½æ•°å†…è”")]),s._v(" "),n("p",[n("code",[s._v("go build")]),s._v("æ—¶ï¼Œå¯é€šè¿‡"),n("code",[s._v("-gcflags")]),s._v("æ ‡è¯†ç»™ç¼–è¯‘å™¨ä¼ å‚ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ ä¼ äº†ä¸¤ä¸ª"),n("code",[s._v("-m")]),s._v("æ ‡è¯†ï¼Œç¼–è¯‘å™¨ä¼šæ±‡æŠ¥å®ƒèƒ½å¤Ÿå´æ²¡æœ‰å†…è”çš„å‡½æ•°ï¼š")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("go build -gcflags"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-m -m"')]),s._v(" io "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v(" io.txt\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" io.txt "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'function too complex'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# éƒ¨åˆ†è¾“å‡º")]),s._v("\nio.go:289:6: cannot inline WriteString: "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" too complex: cost "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("136")]),s._v(" exceeds budget "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("è¿™é¡¹æŠ€å·§æœ‰åŠ©äºå‘ç°èƒ½å¤Ÿä¼˜åŒ–çš„å‡½æ•°ï¼Œä¿ƒä½¿ç¼–è¯‘å™¨å†…è”å®ƒä»¬ã€‚")]),s._v(" "),n("h2",{attrs:{id:"å †çš„å†…å­˜åˆ†é…"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#å †çš„å†…å­˜åˆ†é…"}},[s._v("#")]),s._v(" å †çš„å†…å­˜åˆ†é…")]),s._v(" "),n("p",[n("code",[s._v("-m -m")]),s._v("æ ‡è¯†ä¹Ÿèƒ½ç”¨äºå‘ç°è¡¨è¾¾å¼é€ƒé€¸åˆ°å †è€Œè§¦å‘å†…å­˜åˆ†é…çš„æƒ…å½¢ã€‚çœ‹åˆ°çƒ­å‡½æ•°è¯·æ±‚å¤§é‡å†…å­˜åˆ†é…æ—¶ï¼Œè¿™ä¸ªæŠ€å·§å¯ä»¥å¸®æˆ‘ä»¬æŸ¥åŸå› ï¼š")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("go build -gcflags"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-m -m"')]),s._v(" io "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v(" io.txt\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" io.txt "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'escapes to heaear'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# éƒ¨åˆ†è¾“å‡º")]),s._v("\nio.go:293:23: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("byte"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" escapes to heap\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h2",{attrs:{id:"è¾¹ç•Œæ£€æŸ¥"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#è¾¹ç•Œæ£€æŸ¥"}},[s._v("#")]),s._v(" è¾¹ç•Œæ£€æŸ¥")]),s._v(" "),n("p",[s._v("æ¯æ¬¡ç´¢å¼•åˆ‡ç‰‡æ—¶ï¼Œgolangç¼–è¯‘å™¨ä¼šå¯¹åˆ‡ç‰‡ç”Ÿæˆè¾¹ç•Œæ£€æŸ¥ã€‚golangç¼–è¯‘ä¼šæ‰§è¡Œä¸€è½®ä¼˜åŒ–ï¼ˆæˆä¸ºbalance check eliminationï¼Œç®€ç§°"),n("code",[s._v("bce")]),s._v("ï¼‰ï¼Œå°†è®¤å®šä¸ºé™æ€å®‰å…¨çš„ç´¢å¼•æ“ä½œçš„æ£€æŸ¥ç§»é™¤æ‰ã€‚é€šè¿‡è®¾ç½®ä¸åŒçº§åˆ«çš„è°ƒè¯•æŸ¥çœ‹è¿™äº›æ£€æŸ¥æ˜¯å¦èƒ½å¤Ÿä»ä½ çš„ä»£ç ç§»é™¤ï¼š")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("go build -gcflags"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-d"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ssa/prove/debug"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" io "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v(" io.txt\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" io.txt\n\nio.go:446:8: Proved IsSliceInBounds\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("å¦ä¸€ä¸ªè°ƒè¯•çº§åˆ«çš„ç»“æœå¦‚ä¸‹")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("go build -gcflags"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-d"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ssa/prove/debug"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" io "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v(" io.txt\n~ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" io.txt\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# éƒ¨åˆ†è¾“å‡º")]),s._v("\nmulti.go:59:14: x+d "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" x:v24 b6 delta:1 w:0 d:signed\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"æ¸…ç©ºmaps"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç©ºmaps"}},[s._v("#")]),s._v(" æ¸…ç©ºMaps")]),s._v(" "),n("p",[s._v("Go 1.11ä¹‹å‰ï¼Œæ¸…ç©ºmapæœ€é«˜æ•ˆçš„æ–¹å¼æ˜¯ç”¨æ–°åˆ†é…çš„mapè¦†å†™å®ƒã€‚ä½†æ˜¯ï¼Œè¿™å…¶å®ä¸æ˜¯éå¸¸é«˜æ•ˆçš„ã€‚ä»Go 1.11èµ·ï¼Œæˆ‘ä»¬å¯ä»¥éå†mapçš„é”®ï¼Œé€ä¸ªåˆ é™¤å®ƒä»¬ï¼Œèªæ˜çš„ç¼–è¯‘å™¨ä¼šä¼˜åŒ–è¿™é¡¹æ“ä½œï¼Œå…å¾—ä½ æ–°åˆ†é…ä¸€ä¸‹mapï¼")]),s._v(" "),n("div",{staticClass:"language-go line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// replace a map")]),s._v("\nm "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// clear a map; faster since Go 1.11!")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" k "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("range")]),s._v(" m "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("delete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h2",{attrs:{id:"æ£€æŸ¥å­—ç¬¦ä¸²é•¿åº¦"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æ£€æŸ¥å­—ç¬¦ä¸²é•¿åº¦"}},[s._v("#")]),s._v(" æ£€æŸ¥å­—ç¬¦ä¸²é•¿åº¦")]),s._v(" "),n("p",[s._v("ç±»ä¼¼åœ°ï¼Œä¹‹å‰è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦çš„æœ‰æ•ˆæ–¹å¼æ˜¯éå†è®¡ç®—å…¶ä¸­runeçš„ä¸ªæ•°ã€‚ç°åœ¨å¯ä»¥ç®€åŒ–ä¸ºæ£€æŸ¥runeåˆ‡ç‰‡çš„é•¿åº¦äº†ï¼š")]),s._v(" "),n("div",{staticClass:"language-go line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// count manually")]),s._v("\nn "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("range")]),s._v(" str "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tn"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// simple, and fast since Go 1.11!")]),s._v("\nn "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("len")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rune")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("str"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("æ€»è€Œè¨€ä¹‹ï¼Œå¯ä»¥è€ƒè™‘ç¼–å†™ä¸€äº›èƒ½å¤Ÿè®©ç¼–è¯‘å™¨ä¼˜åŒ–çš„ä»£ç ã€‚")]),s._v(" "),n("h2",{attrs:{id:"å¤šè¯´ä¸€å¥-ssaåˆ†æ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#å¤šè¯´ä¸€å¥-ssaåˆ†æ"}},[s._v("#")]),s._v(" å¤šè¯´ä¸€å¥ï¼šSSAåˆ†æ")]),s._v(" "),n("p",[s._v("å¦‚æœè¯»è¿‡"),n("a",{attrs:{href:"https://github.com/golang/go/blob/master/src/cmd/compile/README.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("ä¸Šé¢çš„Goç¼–è¯‘å™¨æ–‡æ¡£"),n("OutboundLink")],1),s._v("ï¼Œä½ åº”è¯¥äº†è§£åˆ°Goç¼–è¯‘å™¨åŸºäºæºä»£ç çš„SSAï¼ˆStatic Single Assignmentï¼‰å½¢å¼è¿›è¡Œä¼˜åŒ–ã€‚ç”¨ä»–ä»¬çš„è¯è®²ï¼šâ€œè¿™ä¸ªé˜¶æ®µï¼ŒASTä¼šè¢«è½¬æ¢ä¸ºStatic Single Assignment (SSA)å½¢å¼ï¼Œä¸€ç§å…·æœ‰ç‰¹å®šå±æ€§çš„ã€æ›´ä½å±‚æ¬¡çš„ä¸­é—´è¡¨ç¤ºæ³•ï¼Œè¿™ç§è¡¨ç¤ºæ³•ä½¿å¾—ä¼˜åŒ–æ›´åŠ å®¹æ˜“å®ç°ï¼Œå¹¶ç”¨äºæœ€ç»ˆæœºå™¨ç çš„ç”Ÿæˆã€‚â€")]),s._v(" "),n("p",[n("code",[s._v("go build")]),s._v("æ—¶è®¾å®šä¸€ä¸ªç‰¹æ®Šçš„ç¯å¢ƒå˜é‡--"),n("code",[s._v("GOSSAFUNC")]),s._v("ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŸ¥çœ‹ç›¸åº”åŒ…å‡½æ•°çš„SSAè¾“å‡ºäº†ï¼š")]),s._v(" "),n("p",[s._v("ç»™å®šä»£ç å¦‚ä¸‹")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("package code\n\nfunc "),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("HelloWorld")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        println"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello, world!"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("ç”Ÿæˆ"),n("code",[s._v("HelloWorld")]),s._v("ç¨‹åºçš„SSAæŠ¥è¡¨ã€‚")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOSSAFUNC")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("HelloWorld go build\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç”¨æµè§ˆå™¨æ‰“å¼€ç”Ÿæˆçš„ssa.htmlå³å¯çœ‹åˆ°SSAçš„å½¢å¼")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# code")]),s._v("\ndumped SSA to ./ssa.html\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("å¦‚æœ‰å…´è¶£ï¼Œå¯ä»¥é€šè¿‡"),n("a",{attrs:{href:"https://github.com/golang/go/blob/master/src/cmd/compile/internal/ssa/README.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("Goçš„ä»‹ç»æ–‡æ¡£"),n("OutboundLink")],1),s._v("äº†è§£å…¶ç¼–è¯‘å™¨çš„æ›´å¤šå†…éƒ¨æœºç†ã€‚")]),s._v(" "),n("p",[s._v("æ¼”è®²çš„å¹»ç¯ç‰‡å‚è§"),n("a",{attrs:{href:"https://docs.google.com/presentation/d/e/2PACX-1vQ9aFgICdqCz5pjrVJ4zFZrWtTKbfGYFPCOKsScomkLoE1Kzk3DVd9-u4k_XgZekqJ7nl-YTy4lD8Uq/pub",target:"_blank",rel:"noopener noreferrer"}},[s._v("è¿™é‡Œ"),n("OutboundLink")],1),s._v("ã€‚")])])}),[],!1,null,null,null);t.default=e.exports}}]);