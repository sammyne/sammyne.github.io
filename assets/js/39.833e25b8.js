(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{682:function(s,t,a){s.exports=a.p+"assets/img/packets-flow.472c1e6b.png"},683:function(s,t,a){s.exports=a.p+"assets/img/vmware-add-network.461b1a3e.png"},811:function(s,t,a){"use strict";a.r(t);var n=a(6),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"title"},[s._v("温馨提示")]),n("p",[s._v("本文从理论到实践，系统地介绍 iptables。如果你想要从头开始了解 iptables，可以查看 "),n("RouterLink",{attrs:{to:"/tag/iptables/"}},[s._v("iptables 系列文章")]),s._v("。")],1)]),n("div",{staticClass:"custom-block danger"},[n("p",{staticClass:"title"},[s._v("高能预警")]),n("p",[s._v("在进行 iptables 实验时，请务必在测试机上进行。iptables 规则设置不当有可能使你无法连接到远程主机。本文的实验操作环境为 VMware Fusion Pro 12.0 （前面文章使用的是 VMware Fusion Player 12.0）下的 Ubuntu 20.04.1。")])]),n("p",[s._v("阅读这篇文章需要以前面的文章为基础。如果在阅读时遇到障碍，请回顾那些文章。")]),s._v(" "),n("p",[s._v("回顾一下之前的知识。"),n("RouterLink",{attrs:{to:"/2020/12/03/iptables-01-concepts/"}},[s._v("第一篇介绍 iptables 的文章")]),s._v(" 就描述过防火墙的概念。防火墙从逻辑上讲，可以分为")],1),s._v(" "),n("ul",[n("li",[n("strong",[s._v("主机防火墙")]),s._v("：针对于单个主机进行防护。")]),s._v(" "),n("li",[n("strong",[s._v("网络防火墙")]),s._v("：往往处于网络入口或边缘，针对于网络入口进行防护，服务于防火墙背后的本地局域网。")])]),s._v(" "),n("p",[s._v("前面的文章中，iptables 都是作为主机防火墙的角色出现的。本文介绍一下如何把 iptables 应用到网络防火墙。")]),s._v(" "),n("p",[s._v("回到刚才的概念，网络防火墙往往处于网络的入口或者边缘，如果想要使用 iptables 充当网络防火墙，iptables 所在的主机需要处于网络入口处，示意图如下。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("                     +--------------------------------------------------------------------------+\n                     |           +--------+   +--------+   +--------+                           |\n                     |           |  主机 1 |   | 主机 2 |   |  主机 3 |                           |\n                     |           +--------+   +--------+   +--------+                           |\n+-----+ +------\x3e +-----------+                                                                  |\n| 网络 |          | 防火墙主机  |               +---------+   +---------+   +---------+           |\n+-----+ <------+ +-----------+                |  主机 4 |   |   主机 5 |   |   主机 6 |           |\n                     |                        +---------+   +---------+   +---------+           |\n                     |                                                                          |\n                     |                                     +--------+   +--------+   +--------+ |\n                     | 内部网络                             |  主机 7 |   |  主机 8 |   | 主机 9 | |\n                     |                                     +--------+   +--------+   +--------+ |\n                     |                                                                          |\n                     |                                                  ...                     |\n                     |                                                                          |\n                     +--------------------------------------------------------------------------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[s._v("上图的防火墙主机为 iptables 所在主机。此时 iptables 充当的角色即为网络防火墙。最大的虚线框表示网络防火墙所防护的网络区域。")]),s._v(" "),n("p",[s._v('当外部网络的主机与网络内部主机通讯时，不管是由外部主机发往内部主机的报文，还是由内部主机发往外部主机的报文，都需要经过 iptables 所在的主机，由 iptables 所在的主机进行"过滤并转发"。因此，防火墙主机的主要工作就是"过滤并转发"。说到这里，再回顾之前的 iptables 报文流程图如下：')]),s._v(" "),n("p",[n("img",{attrs:{src:a(682),alt:""}})]),s._v(" "),n("p",[s._v('前面的文章中，iptables 都是作为"主机防火墙"的角色出现的。所以举例只用到上图的 '),n("code",[s._v("INPUT")]),s._v(" 链与 "),n("code",[s._v("OUTPUT")]),s._v(' 链。因为拥有"过滤功能"的链只有 3 条--'),n("code",[s._v("INPUT")]),s._v("、"),n("code",[s._v("OUTPUT")]),s._v(" 和 "),n("code",[s._v("FORWARD")]),s._v("，当报文发往本机时，如果想要过滤，只能在 "),n("code",[s._v("INPUT")]),s._v(" 链与 "),n("code",[s._v("OUTPUT")]),s._v(' 链实现。而此时，iptables 的角色发生了转变--成为了"网络防火墙"。而刚才说过网络防火墙的职责就是"过滤并转发"，"过滤"只能在 '),n("code",[s._v("INPUT")]),s._v("、"),n("code",[s._v("OUTPUT")]),s._v(" 和 "),n("code",[s._v("FORWARD")]),s._v(' 三条链实现，"转发"报文则只会经过 '),n("code",[s._v("FORWARD")]),s._v(" 链（发往本机的报文才会经过 "),n("code",[s._v("INPUT")]),s._v('链）。综上，iptables 的角色变为"网络防火墙"时，规则只能定义在 '),n("code",[s._v("FORWARD")]),s._v(" 链。")]),s._v(" "),n("h2",{attrs:{id:"环境准备"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[s._v("#")]),s._v(" 环境准备")]),s._v(" "),n("p",[s._v("那么为了能够进行实验，我们设置如下所示实验场景（后面有对图的解释）")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("+----------------+\n| 172.16.39.8: A |\n+---+---------+--+\n    |         ^             +---------------------------------------------+\n    |         |             |                            +-------------+  |\n    |         |             |                            |    ...      |  |\n+------------------------------------------ +            +-------------+  |\n|   |         |             |               |                             |\n| +-v---------+-+           | +----------+ +-----------\x3e +-------------+  |\n| | 172.16.39.2 |           | | 10.1.0.2 |  |            | C: 10.1.0.3 |  |\n| +-------------+           | +----------+ <-----------+ +-------------+  |\n|    网卡 1          主机 B  |    网卡 2      |                             |\n+------------------------------------------ +            +-------------+  |\n                            |                            |    ...      |  |\n                            | 内部网络                    +-------------+  |\n                            +---------------------------------------------+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[s._v("假设上图最大虚线框所示的网络为内部网络。")]),s._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"title"},[s._v("注意")]),n("p",[s._v("此处所描述的内网、外网与我们平常所说的公网、私网不同。内外部网络可以理解成两个网段，A 网络与 B 网络。为了方便描述，我们把右边最大虚线框内的主机称为内部主机，最大虚线框所表示的网络称为内部网络，圆形外的网络称为外部网络。")])]),n("p",[s._v("假设内部网络的网段为 "),n("code",[s._v("10.1.0.0/16")]),s._v("。此内部网络存在主机 C，其 IP 地址为 "),n("code",[s._v("10.1.0.3")]),s._v("。")]),s._v(" "),n("p",[s._v("上图的主机 B 充当网络防火墙的角色，也属于内部网络，同时主机 B 也能与外部网络进行通讯。主机 B 有两块网卡--网卡 1 与网卡 2，IP 地址分别为 "),n("code",[s._v("10.1.0.2")]),s._v(" 和 "),n("code",[s._v("172.16.39.2")]),s._v("，所以防火墙主机在内部网络的 IP 地址为 "),n("code",[s._v("10.1.0.2")]),s._v("，防火墙主机与外部网络通信的 IP 地址为 "),n("code",[s._v("172.16.39.2")]),s._v("。")]),s._v(" "),n("p",[s._v('主机 A 充当"外部网络主机"的角色，IP 地址为 '),n("code",[s._v("172.16.39.8")]),s._v("。我们使用主机 A 访问内部网络的主机 C，但是需要主机 B 进行转发。主机 B 在转发报文时会进行过滤，以实现网络防火墙的功能。")]),s._v(" "),n("p",[s._v("我已经准备了 3 台虚拟机：A、B 和 C。")]),s._v(" "),n("p",[s._v("虚拟机 A 与虚拟机 B 的网卡 2 都使用了桥接模式。")]),s._v(" "),n("p",[s._v('为了能够尽量模拟内部网络的网络入口，我们将虚拟机 B 的网卡 1 与虚拟机 C 同时放在"仅主机模式"的虚拟网络，操作如下（本人的操作系统为 macOS）')]),s._v(" "),n("ol",[n("li",[s._v('点击 VMware Fusion "Preferences" 菜单')]),s._v(" "),n("li",[s._v('选择 "Network" 面板')]),s._v(" "),n("li",[s._v("暂时解锁更改设置")]),s._v(" "),n("li",[s._v("添加如图所示仅主机模式的虚拟网络 "),n("code",[s._v("vmnet2")]),s._v("，设置子网地址为 "),n("code",[s._v("10.1.0.0")]),s._v("，子网掩码为 "),n("code",[s._v("255.255.0.0")])])]),s._v(" "),n("p",[s._v("下图的 vmnet2 为已经添加过的虚拟网络，此处不再重复添加。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(683),alt:'将虚拟机 B 的网卡 1 与虚拟机 C 同时放在"仅主机模式"的虚拟网络'}})]),s._v(" "),n("p",[s._v("由于 B 主机现在的角色是 "),n("code",[s._v("10.1.0.0")]),s._v(' 的"网络防火墙"。直接将 C 主机的网关指向 B 主机的内部网络 IP，如下图所示（命令的执行顺序很重要）')]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"title"},[s._v("温馨提示")]),n("p",[n("code",[s._v("route")]),s._v(" 命令配置的路由条目在网络重启后将会失效。匹配度更精确的路由表项优先级更高。")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu2:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# route")]),s._v("\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".0.0     U     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ens33\nlink-local      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".0.0     U     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ens33\nroot@ubuntu2:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# route add -net 0.0.0.0 gw 10.1.0.2")]),s._v("\nroot@ubuntu2:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# route del -net 10.1.0.0/16")]),s._v("\nroot@ubuntu2:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# route -n")]),s._v("\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.2        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         UG    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ens33\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("169.254")]),s._v(".0.0     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".0.0     U     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ens33\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("同时，为了尽量简化路由设置，直接将 A 主机访问 "),n("code",[s._v("10.1")]),s._v(" 网络时的网关指向 B 主机的网卡 2 的 IP，如下图所示。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu3:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ifconfig | awk '/inet / {print $1,$2}'")]),s._v("\ninet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".39.8\ninet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\nroot@ubuntu3:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# route add -net 10.1.0.0/16 gw 172.16.39.2")]),s._v("\nroot@ubuntu3:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# route -n")]),s._v("\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".39.1     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         UG    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ens33\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".39.2     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".0.0     UG    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ens33\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("169.254")]),s._v(".0.0     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".0.0     U     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ens33\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".39.0     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0   U     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ens33\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("现在 A 主机通往 "),n("code",[s._v("10.1")]),s._v(" 网络的网关已经指向 B 主机。我们再试试 A 主机能否达到 "),n("code",[s._v("10.1.0.0/16")]),s._v(" 网络。")]),s._v(" "),n("p",[s._v("如下所示，直接在 A 主机向 C 主机发起 "),n("code",[s._v("ping")]),s._v(" 请求，并没有得到任何回应。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu3:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ping 10.1.0.3")]),s._v("\nPING "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.3 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\n^C\n--- "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.3 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" packets transmitted, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" received, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("% packet loss, "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" 3075ms\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("再试试 B 主机的内部网 IP。如下所示，直接在 A 主机向 B 主机的内部网 IP 发起 "),n("code",[s._v("ping")]),s._v(" 请求，发现是可以 "),n("code",[s._v("ping")]),s._v(" 通。这是为什么呢？")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu3:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ping 10.1.0.2")]),s._v("\nPING "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.2 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.2: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.654")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.2: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.11")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.2: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.12")]),s._v(" ms\n^C\n--- "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.2 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets transmitted, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" received, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss, "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" 2017ms\nrtt min/avg/max/mdev "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.654")]),s._v("/0.963/1.123/0.218 ms\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("按照道理来说，"),n("code",[s._v("10.1.0.3")]),s._v(" 与 "),n("code",[s._v("10.1.0.2")]),s._v(" 都属于 "),n("code",[s._v("10.1.0.0/16")]),s._v("网段，为什么 B 主机的 IP 就能通，C 主机的 IP 却不通呢？")]),s._v(" "),n("p",[s._v("先分析 "),n("code",[s._v("10.1.0.3")]),s._v(" 没有回应的原因。")]),s._v(" "),n("p",[s._v("A 主机通过路由表得知，发往 "),n("code",[s._v("10.1.0.0/16")]),s._v(" 网段的报文网关为 B 主机。当报文达到 B 主机时，B 主机发现 A 的目标为 "),n("code",[s._v("10.1.0.3")]),s._v("，而自己的 IP 是 "),n("code",[s._v("10.1.0.2")]),s._v("。这时，B 主机需要将这个报文转发给 "),n("code",[s._v("10.1.0.3")]),s._v("（也就是 C 主机）。但是，Linux 主机在默认情况下，并不会转发报文。如果想要让 Linux 主机能够转发报文，需要额外的设置。这就是为什么 "),n("code",[s._v("10.1.0.3")]),s._v(" 没有回应的原因--因为 B 主机压根就没有将 A 主机的 "),n("code",[s._v("ping")]),s._v(" 请求转发给 C 主机，导致 C 主机没有收到 A 的 "),n("code",[s._v("ping")]),s._v(" 请求，所以 A 自然得不到回应。")]),s._v(" "),n("p",[s._v("现在再来聊聊为什么 "),n("code",[s._v("10.1.0.2")]),s._v(" 会回应。")]),s._v(" "),n("p",[s._v("这是因为 "),n("code",[s._v("10.1.0.2")]),s._v(" 与 "),n("code",[s._v("172.16.39.2")]),s._v(" 这个 IP 都属于 B 主机。当 A 主机通过路由表将 "),n("code",[s._v("ping")]),s._v(" 报文发送到 B 主机时，B 主机发现自己既是 "),n("code",[s._v("172.16.39.2")]),s._v(" 又是 "),n("code",[s._v("10.1.0.2")]),s._v("，所以就直接回应了 A 主机，并没有将报文转发给谁，从而让 A 主机能够得到 "),n("code",[s._v("10.1.0.2")]),s._v(" 的回应。")]),s._v(" "),n("p",[s._v("大致原因分析如上。接下来我们再学习一下设置 Linux 主机转发报文。")]),s._v(" "),n("p",[s._v("首先查看 "),n("code",[s._v("/proc/sys/net/ipv4/ip_forward")]),s._v(" 的文件内容。如果文件内容为 0，则表示当前主机不支持转发。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /proc/sys/net/ipv4/ip_forward")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("如果想要让当前主机支持核心转发功能，只需要将此文件的值设置为 1 即可。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo 1 > /proc/sys/net/ipv4/ip_forward")]),s._v("\nroot@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /proc/sys/net/ipv4/ip_forward")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("现在就开启了 B 主机的核心转发功能。")]),s._v(" "),n("p",[s._v("除了上述方法，还能使用 "),n("code",[s._v("sysctl")]),s._v(" 命令去设置是否开启核心转发。示例如下")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sysctl -w net.ipv4.ip_forward=0")]),s._v("\nnet.ipv4.ip_forward "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nroot@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /proc/sys/net/ipv4/ip_forward")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nroot@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sysctl -w net.ipv4.ip_forward=1")]),s._v("\nnet.ipv4.ip_forward "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nroot@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /proc/sys/net/ipv4/ip_forward")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("上述两种方法都能控制是否开启核心转发。但是通过上述两种方法设置的时效都是临时的，会因重启网络服务而失效。")]),s._v(" "),n("p",[s._v("如果想要永久生效，则需要设置 "),n("code",[s._v("/etc/sysctl.conf")]),s._v(" 文件，添加（或修改）配置项 "),n("code",[s._v("net.ipv4.ip_forward = 1")]),s._v(" 如下即可。")]),s._v(" "),n("p",[s._v("至此，B 主机已经具备了核心转发功能，可以转发报文了。现在再次回到 A 主机，向 C 主机发起 "),n("code",[s._v("ping")]),s._v(" 请求。如下所示，可见已经可以 "),n("code",[s._v("ping")]),s._v(" 通。")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"title"},[s._v("温馨提示")]),n("p",[s._v("如果你仍然无法 "),n("code",[s._v("ping")]),s._v(" 通，可能是因为你使用 "),n("code",[s._v("route")]),s._v(" 命令配置了 C 主机的默认网关。这种情况下，请查看 C 主机的路由配置是否自动消失。如果没有对应的路由条目，请重新配置。同时，如果你的主机 C 如果有多块网卡，可以暂时禁用其他网卡试试。")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu3:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ping 10.1.0.3")]),s._v("\nPING "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.3 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.3: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.16")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.3: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.82")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.3: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.69")]),s._v(" ms\n^C\n--- "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.3 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets transmitted, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" received, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss, "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" 2005ms\nrtt min/avg/max/mdev "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.164")]),s._v("/1.557/1.823/0.283 ms\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("同时，从主机 C 向主机 A 发起 "),n("code",[s._v("ping")]),s._v(" 请求，也可以 "),n("code",[s._v("ping")]),s._v(" 通，如下所示")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu2:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ping 172.16.39.8")]),s._v("\nPING "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".39.8 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".39.8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".39.8: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.15")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".39.8: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.74")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".39.8: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.10")]),s._v(" ms\n^C\n--- "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".39.8 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" packets transmitted, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" received, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss, "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" 2006ms\nrtt min/avg/max/mdev "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.152")]),s._v("/1.662/2.098/0.389 ms\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("至此，测试环境已经准备完毕，可以开始测试了。")]),s._v(" "),n("p",[s._v('因为此处主要测试"网络防火墙"，在开始之前，请确认主机 A 与主机 C 没有对应的 iptables 规则。为了减少主机防火墙带来的影响，直接执行 '),n("code",[s._v("iptables -F")]),s._v(" 将主机 A 与 C 的规则清空。")]),s._v(" "),n("h2",{attrs:{id:"网络防火墙测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#网络防火墙测试"}},[s._v("#")]),s._v(" 网络防火墙测试")]),s._v(" "),n("p",[s._v('之前说过，iptables 作为网络防火墙时，主要负责"过滤与转发"。既然要过滤，则需配置 filter 表，既然要转发，则需在 '),n("code",[s._v("FORWAED")]),s._v(" 链定义规则。所以，我们应该往 filter 表的 "),n("code",[s._v("FORWARD")]),s._v(" 链配置规则。")]),s._v(" "),n("p",[s._v("先来看看主机 B 的 filter 表是否已经存在规则，如下")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -L")]),s._v("\nChain INPUT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ntarget     prot opt "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\n\nChain FORWARD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ntarget     prot opt "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\n\nChain OUTPUT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ntarget     prot opt "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("可见，"),n("code",[s._v("FORWARD")]),s._v(" 链没有任何规则，默认策略为 "),n("code",[s._v("ACCEPT")]),s._v('，我们可以使用"白名单机制"（如果忘了请回顾 '),n("RouterLink",{attrs:{to:"/2021/01/08/iptables-09-whitelist-and-blacklist/"}},[s._v("黑白名单机制")]),s._v("）。")],1),s._v(" "),n("p",[s._v("在主机 B 的 "),n("code",[s._v("FORWARD")]),s._v(' 链的末端添加一条默认拒绝的规则，然后将"放行规则"设置在这条"默认拒绝规则"之前即可。')]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -I FORWARD -j REJECT")]),s._v("\nroot@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -L FORWARD")]),s._v("\nChain FORWARD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ntarget     prot opt "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\nREJECT     all  --  anywhere             anywhere             reject-with icmp-port-unreachable\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("配置完上述规则后，主机 A 与主机 C 已经无法通讯。")]),s._v(" "),n("p",[s._v("主机 A 的情况如下")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu3:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ping 10.1.0.3")]),s._v("\nPING "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.3 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\nFrom "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".39.2 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" Destination Port Unreachable\nFrom "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".39.2 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" Destination Port Unreachable\n^C\n--- "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.3 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" packets transmitted, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" received, +2 errors, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("% packet loss, "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" 1033ms\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("主机 C 的情况如下")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("root@ubuntu2:~# ping 172.16.39.8\nPING 172.16.39.8 (172.16.39.8) 56(84) bytes of data.\nFrom 10.1.0.2 icmp_seq=1 Destination Port Unreachable\nFrom 10.1.0.2 icmp_seq=2 Destination Port Unreachable\n^C\n--- 172.16.39.8 ping statistics ---\n2 packets transmitted, 0 received, +2 errors, 100% packet loss, time 1010ms\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("它们之间的通信需要靠主机 B 进行转发。而上述规则设置完成后，所有报文都无法通过 "),n("code",[s._v("FORWARD")]),s._v(" 链，所以任何转发报文在经过 "),n("code",[s._v("FORWARD")]),s._v(" 链时都会被拒绝，外部主机的报文无法转发到内部主机，内部网主机的报文也无法转发到外部主机，因为主机 B 已经拒绝转发所有报文。")]),s._v(" "),n("p",[s._v("现在同时将 A 主机与 C 主机的 web 服务启动，以便进行测试（需安装 mini-httpd）。")]),s._v(" "),n("p",[s._v("首先启动 A 主机的 httpd 服务")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu3:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir hello")]),s._v("\nroot@ubuntu3:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd hello/")]),s._v("\nroot@ubuntu3:~/hello"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "I\'m A" > index.html')]),s._v("\nroot@ubuntu3:~/hello"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mini_httpd -h 0.0.0.0")]),s._v("\nroot@ubuntu3:~/hello"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mini_httpd: started as root without requesting chroot(), warning only")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("然后，启动 C 主机的 httpd 服务")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu2:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir hello")]),s._v("\nroot@ubuntu2:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd hello/")]),s._v("\nroot@ubuntu2:~/hello"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "I\'m C" > index.html')]),s._v("\nroot@ubuntu2:~/hello"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mini_httpd -h 0.0.0.0")]),s._v("\nroot@ubuntu2:~/hello"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mini_httpd: started as root without requesting chroot(), warning only")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("由于主机 B 设置了默认拒绝的规则，所以此刻 A 主机无法访问 C 主机的 web 服务， C 主机同样无法访问 A 主机的 web 服务。")]),s._v(" "),n("p",[s._v("如果想要使内部的主机能够访问外部主机的 web 服务，应该怎样做呢？需要在 "),n("code",[s._v("FORWARD")]),s._v(" 链放行内部主机对外部主机的 web 请求，配置如下即可。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -L FORWARD")]),s._v("\nChain FORWARD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ntarget     prot opt "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\nREJECT     all  --  anywhere             anywhere             reject-with icmp-port-unreachable\nroot@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -I FORWARD -s 10.1.0.0/16 -p tcp --dport 80 -j ACCEPT")]),s._v("\nroot@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -L FORWARD")]),s._v("\nChain FORWARD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ntarget     prot opt "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\nACCEPT     tcp  --  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16          anywhere             tcp dpt:http\nREJECT     all  --  anywhere             anywhere             reject-with icmp-port-unreachable\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("如上所示，因为我们将来自内部网络目标端口为 80 的报文都放行了，所以防火墙放行内部主机的 web 请求。那么此时，C 主机访问 A 主机的 web 服务试试。结果如下")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu2:~/hello"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl 172.16.39.8")]),s._v("\n^C\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("可以看到，主机 C 并无法访问到主机 A 上的 web 服务，这是为什么呢？")]),s._v(" "),n("p",[s._v("因为只在主机 B 放行了内部主机访问 80 端口的请求，但是并没有放行外部主机的回应报文。虽然内部主机的请求能够通过防火墙主机 B 转发出去，但是回应的报文则无法进入防火墙，所以仍然需要在主机 B 进行如下设置。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -L FORWARD")]),s._v("\nChain FORWARD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ntarget     prot opt "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\nACCEPT     tcp  --  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16          anywhere             tcp dpt:http\nREJECT     all  --  anywhere             anywhere             reject-with icmp-port-unreachable\nroot@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -I FORWARD -d 10.1.0.0/16 -p tcp --sport 80 -j ACCEPT")]),s._v("\nroot@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -L FORWARD")]),s._v("\nChain FORWARD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ntarget     prot opt "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\nACCEPT     tcp  --  anywhere             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16          tcp spt:http\nACCEPT     tcp  --  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16          anywhere             tcp dpt:http\nREJECT     all  --  anywhere             anywhere             reject-with icmp-port-unreachable\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("如上所示，当外部主机的 web 服务响应内部主机时，目标地址肯定为内部主机，所以我们放行目标 IP 属于内部主机网段且源端口为 80 的报文，因为外部主机肯定会使用 80 端口进行回应。")]),s._v(" "),n("p",[s._v("完成上述配置后，再次回到 C 主机，即可正常访问 A 主机的 web 服务。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu2:~/hello"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl 172.16.39.8")]),s._v("\nI'm A\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v('可见，iptables 作为"网络防火墙"的场景下，配置规则往往需要考虑"双向性"。也就是说，为了达成一个目的，往往需要两条规则才能完成。')]),s._v(" "),n("p",[s._v("此时，A 主机依然无法访问 C 主机的 web 服务，因为 B 主机并没有放行相关报文。")]),s._v(" "),n("p",[s._v('结合之前的知识，我们可以将上述规则配置进行优化。比如，不管是由内而外，还是由外而内，只要是"响应报文"统统放行，配置如下')]),s._v(" "),n("blockquote",[n("p",[s._v("注：如果你没有明白如下配置的含义，请回顾之前的 "),n("RouterLink",{attrs:{to:"/2021/01/08/iptables-08-extended-modules-state/"}},[s._v("state 扩展模块")]),s._v("。")],1)]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables --line -vL FORWARD")]),s._v("\nChain FORWARD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" packets, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" bytes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nnum   pkts bytes target     prot opt "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("437")]),s._v(" ACCEPT     tcp  --  any    any     anywhere             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16          tcp spt:http\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("771")]),s._v(" ACCEPT     tcp  --  any    any     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16          anywhere             tcp dpt:http\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3525")]),s._v("  229K REJECT     all  --  any    any     anywhere             anywhere             reject-with icmp-port-unreachable\nroot@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -D FORWARD 1")]),s._v("\nroot@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -I FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT")]),s._v("\nroot@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables --line -vL FORWARD")]),s._v("\nChain FORWARD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" packets, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" bytes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nnum   pkts bytes target     prot opt "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ACCEPT     all  --  any    any     anywhere             anywhere             state RELATED,ESTABLISHED\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("771")]),s._v(" ACCEPT     tcp  --  any    any     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16          anywhere             tcp dpt:http\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3633")]),s._v("  237K REJECT     all  --  any    any     anywhere             anywhere             reject-with icmp-port-unreachable\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v('如上图所示，先将"web 响应报文放行规则"删除，同时增加第 8 行规则。只需要在网络防火墙主机的 '),n("code",[s._v("FORWARD")]),s._v(' 链添加如上规则，就可以将绝大多数响应报文放行。不管是外部响应内部，还是内部响应外部，一条规则就能搞定。当 iptables 作为网络防火墙时，每次配置规则都要考虑"双向"的问题。但是配置完上述规则后，只要考虑请求报文的方向即可。而回应报文，上述一条规则就能搞定。这样配置，即使以后有更多服务的响应报文需要放行，我们也不用再去针对响应报文设置规则了（具体原因 '),n("RouterLink",{attrs:{to:"/2021/01/08/iptables-08-extended-modules-state/"}},[s._v("state 扩展模块")]),s._v(" 已经详细的总结过），会省去不少规则。")],1),s._v(" "),n("p",[s._v("比如，除了想要让内部主机能够访问外部的 web 服务，还想让内部主机能够访问外部的 sshd 服务，则可以进行如下设置")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables --line -vL FORWARD")]),s._v("\nChain FORWARD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" packets, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" bytes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nnum   pkts bytes target     prot opt "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ACCEPT     all  --  any    any     anywhere             anywhere             state RELATED,ESTABLISHED\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("771")]),s._v(" ACCEPT     tcp  --  any    any     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16          anywhere             tcp dpt:http\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3633")]),s._v("  237K REJECT     all  --  any    any     anywhere             anywhere             reject-with icmp-port-unreachable\nroot@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -I FORWARD -s 10.1.0.0/16 -p tcp --dport 22 -j ACCEPT")]),s._v("\nroot@ubuntu:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -vL FORWARD")]),s._v("\nChain FORWARD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" packets, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" bytes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\n    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ACCEPT     tcp  --  any    any     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16          anywhere             tcp dpt:ssh\n    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("668")]),s._v(" ACCEPT     all  --  any    any     anywhere             anywhere             state RELATED,ESTABLISHED\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("831")]),s._v(" ACCEPT     tcp  --  any    any     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16          anywhere             tcp dpt:http\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4057")]),s._v("  264K REJECT     all  --  any    any     anywhere             anywhere             reject-with icmp-port-unreachable\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v('上面只要考虑内部主机请求方向的报文规则即可，因为响应报文的规则已被之前配置的规则"承包"。')]),s._v(" "),n("p",[s._v("此刻，使用 C 主机即可访问 A 主机的 22 端口。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("root@ubuntu2:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh sammy@172.16.39.8")]),s._v("\nThe authenticity of "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'172.16.39.8 (172.16.39.8)'")]),s._v(" can"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'t be established.\nECDSA key fingerprint is SHA256:vYot0T5Xa+31Fa6BRAhbCmAdQr6i7MSuwsDN7xrd7co.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".39.8"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("' (ECDSA) to the list of known hosts.\nsammy@172.16.39.8'")]),s._v("s password:\nWelcome to Ubuntu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.04")]),s._v(".1 LTS "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GNU/Linux "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.4")]),s._v(".0-58-generic x86_64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("203")]),s._v(" updates can be installed immediately.\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" of these updates are security updates.\nTo see these additional updates run: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" list --upgradable\n\nYour Hardware Enablement Stack "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HWE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" is supported "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("until")]),s._v(" April "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v(".\nLast login: Thu Jan  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":23:04 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".39.1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[s._v("目前只允许内部主机访问外部主机的 web 服务与 sshd 服务，但是外部主机还无法访问内部主机的服务。具体配置不再赘述，自救吧。")]),s._v(" "),n("h2",{attrs:{id:"小结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),n("p",[s._v("为了便于以后速查，上述过程总结一下。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果想要 iptables 作为网络防火墙，iptables 所在主机开启核心转发功能，以便能够转发报文。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用如下命令查看当前主机是否已经开启了核心转发，0表示为开启，1表示已开启")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/sys/net/ipv4/ip_forward\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用如下两种方法均可临时开启核心转发，立即生效，但是重启网络配置后会失效。")]),s._v("\n方法一：echo "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/ipv4/ip_forward\n方法二：sysctl -w net.ipv4.ip_forward"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用如下方法开启核心转发功能，重启网络服务后永久生效。")]),s._v("\n配置 /etc/sysctl.conf 文件（CentOS "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" 配置 /usr/lib/sysctl.d/00-system.conf 文件），在配置文件中将 net.ipv4.ip_forward 设置为 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 由于 iptables 此时的角色为"网络防火墙"，所以需要在 filter 表的 FORWARD 链设置规则。')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 可以使用"白名单机制"，先添加一条默认拒绝的规则，然后再为需要放行的报文设置规则。')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 配置规则时需要考虑"方向问题"，针对请求报文与回应报文，考虑报文的源地址与目标地址，源端口与目标端口等。')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例为允许网络内主机访问网络外主机的 web 服务与 sshd 服务。")]),s._v("\niptables -A FORWARD -j REJECT\niptables -I FORWARD -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16 -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" -j ACCEPT\niptables -I FORWARD -d "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16 -p tcp --sport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" -j ACCEPT\niptables -I FORWARD -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16 -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" -j ACCEPT\niptables -I FORWARD -d "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16 -p tcp --sport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" -j ACCEPT\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 可以使用 state 扩展模块，对上述规则进行优化。使用如下配置可以省略许多"回应报文放行规则"。')]),s._v("\niptables -A FORWARD -j REJECT\niptables -I FORWARD -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16 -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" -j ACCEPT\niptables -I FORWARD -s "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.0/16 -p tcp --dport "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" -j ACCEPT\niptables -I FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("p",[s._v("一些注意点：")]),s._v(" "),n("ol",[n("li",[s._v("当测试网络防火墙时，默认前提为网络已经正确配置。")]),s._v(" "),n("li",[s._v("当测试网络防火墙时，如果出现问题，请先确定主机防火墙规则的配置没有问题。")])]),s._v(" "),n("h2",{attrs:{id:"参考文献"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考文献"}},[s._v("#")]),s._v(" 参考文献")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://www.zsythink.net/archives/1663",target:"_blank",rel:"noopener noreferrer"}},[s._v("iptables 详解（11）：iptables 之网络防火墙"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports}}]);