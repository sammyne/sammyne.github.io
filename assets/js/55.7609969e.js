(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{780:function(s,t,a){"use strict";a.r(t);var n=a(6),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"初次见面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初次见面"}},[s._v("#")]),s._v(" 初次见面")]),s._v(" "),a("p",[s._v("ELF 全称叫 Executable and Linkable Format。经常在 Linux 系统开发的小伙伴们应该熟悉 ELF，特别是那些需要了解编译和链接的大神。")]),s._v(" "),a("p",[s._v("本文介绍 Linux 系统编译、链接的基石--ELF 文件。了解这些知识有助于后继续学习编译、链接的底层过程，以及掌握可执行程序在从硬盘加载到内存、一直到 "),a("code",[s._v("main")]),s._v(" 函数的执行的细节。掌握 ELF 文件的结构和内容是理解编译、链接和程序执行的基础。")]),s._v(" "),a("p",[s._v("文件需要遵守一定的格式，ELF 也不例外。从宏观上看，ELF 可拆卸成以下四个部分：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("+----------------------+\n|       ELF header     |  ELF 头部\n+----------------------+\n| Program header table |  程序头表\n+----------------------+\n|       Sections       |  节\n+----------------------+\n| Section Header table |  节头表\n+----------------------+\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("暂时不理解上图的几个概念也没关系，后续部分会逐一说明。")]),s._v(" "),a("p",[s._v("在 Linux 系统中，ELF 文件主要用来表示以下 3 种类型的文件：")]),s._v(" "),a("ul",[a("li",[s._v("可执行文件")]),s._v(" "),a("li",[s._v("目标文件（"),a("code",[s._v(".o")]),s._v("）")]),s._v(" "),a("li",[s._v("共享库文件（"),a("code",[s._v(".so")]),s._v("）")])]),s._v(" "),a("p",[s._v("3 种类型的文件区分通过 ELF 头部的一个字段实现，各自的使用场景分别为：")]),s._v(" "),a("ul",[a("li",[s._v("可执行文件：被操作系统的加载器从硬盘读取，载入到内存去执行")]),s._v(" "),a("li",[s._v("目标文件：被链接器读取，用来产生可执行文件或者共享库文件")]),s._v(" "),a("li",[s._v("共享库文件：在动态链接的时候，由 ld-linux.so 读取")])]),s._v(" "),a("p",[s._v("以链接器和加载器为例，两者看待 ELF 文件的姿势是不一样的。")]),s._v(" "),a("p",[s._v("链接器只看到以下 3 部分内容：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("+----------------------+\n|       ELF header     |  ELF 头部\n+----------------------+\n|          N/A         |  看不到\n+----------------------+\n|       Sections       |  节\n+----------------------+\n| Section Header table |  节头表\n+----------------------+\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("也就是说，链接器只关心 "),a("strong",[s._v("ELF 头部")]),s._v("（ELF header）, "),a("strong",[s._v("节")]),s._v("（Sections） 以及"),a("strong",[s._v("节头表")]),s._v("（Section header table） 这 3 部分内容。")]),s._v(" "),a("p",[s._v("加载器则看到另外 3 部分内容：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("+----------------------+\n|       ELF header     |  ELF 头部\n+----------------------+\n| Program header table |  程序头表\n+----------------------+\n|       Sections       |  节\n+----------------------+\n|        N/A           |  看不到\n+----------------------+\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("加载器只关心 "),a("strong",[s._v("ELF 头部")]),s._v(", "),a("strong",[s._v("程序头表")]),s._v("（Program header table）和 "),a("strong",[s._v("节")]),s._v(" 这 3 部分内容。加载器又把中间部分的节叫做"),a("strong",[s._v("段")]),s._v("（Segments）。可以理解为：一个段可能包含一个或者多个节，就像下面这样：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("          +----------------------+\n          |       ELF header     |\n          +----------------------+\n+---------+ Program header table |              // 加载器看到一个 Segment\n|         +----------------------+\n|         | +------------------+ |\n|    +------+     .text        +<----------+\n+---\x3e+    | +------------------+ |         |\n     |    | +------------------+ |         |\n     +------+     .rodata      +<----------+\n          | +------------------+ |         |\n          | +------------------+ |         |\n          | |     .data        | |         |\n          | +------------------+ |         |\n          | +------------------+ |         |\n          | |     .bss         | |         |\n          | +------------------+ |         |\n          +----------------------+         |\n          | Section Header table +---------+   // 连接器看到两个 Sections\n          +----------------------+\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("这就好比超市里的货架摆放的商品：有矿泉水、可乐、啤酒、巧克力、牛肉干、薯片。从理货员的角度看：它们属于 6 种不同的商品；但是从超市经理的角度看，它们只属于 2 类商品：饮料和零食。")]),s._v(" "),a("p",[s._v("其实只要掌握到 2 点内容就可以了：")]),s._v(" "),a("ul",[a("li",[s._v("一个 ELF 文件由 4 个部分组成")]),s._v(" "),a("li",[s._v("链接器和加载器使用 ELF 时，只会使用各自感兴趣的部分")])]),s._v(" "),a("h2",{attrs:{id:"linux-系统描述-elf-的数据结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linux-系统描述-elf-的数据结构"}},[s._v("#")]),s._v(" Linux 系统描述 ELF 的数据结构")]),s._v(" "),a("p",[s._v("以下结构均源自文件 "),a("a",{attrs:{href:"https://man7.org/linux/man-pages/man5/elf.5.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("elf(5) — linux manual page"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token macro-name"}},[s._v("EI_NIDENT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")])])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ELF header")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" e_ident"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("EI_NIDENT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint16_t")]),s._v("      e_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint16_t")]),s._v("      e_machine"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v("      e_version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  Elf64_Addr    e_entry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  Elf64_Off     e_phoff"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  Elf64_Off     e_shoff"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v("      e_flags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint16_t")]),s._v("      e_ehsize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint16_t")]),s._v("      e_phentsize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint16_t")]),s._v("      e_phnum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint16_t")]),s._v("      e_shentsize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint16_t")]),s._v("      e_shnum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint16_t")]),s._v("      e_shstrndx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" Elf64_Ehdr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Program header table")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v("   p_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v("   p_flags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  Elf64_Off  p_offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  Elf64_Addr p_vaddr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  Elf64_Addr p_paddr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint64_t")]),s._v("   p_filesz"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint64_t")]),s._v("   p_memsz"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint64_t")]),s._v("   p_align"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" Elf64_Phdr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Section header table")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v("   sh_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v("   sh_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint64_t")]),s._v("   sh_flags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  Elf64_Addr sh_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  Elf64_Off  sh_offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint64_t")]),s._v("   sh_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v("   sh_link"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v("   sh_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint64_t")]),s._v("   sh_addralign"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint64_t")]),s._v("   sh_entsize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" Elf64_Shdr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br")])]),a("h2",{attrs:{id:"elf-头部"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#elf-头部"}},[s._v("#")]),s._v(" ELF 头部")]),s._v(" "),a("p",[s._v("ELF 头部相当于是一个总管，决定整个 ELF 文件内部的所有信息，比如：")]),s._v(" "),a("ul",[a("li",[s._v("标记这是 ELF 文件")]),s._v(" "),a("li",[s._v("一些基本信息：版本，文件类型，机器类型")]),s._v(" "),a("li",[s._v("程序头表的开始地址，在整个文件的什么地方")]),s._v(" "),a("li",[s._v("节头表的开始地址，在整个文件的什么地方")])]),s._v(" "),a("p",[s._v("到目前为止，好像没有说节（从链接器角度看）或者段（从加载器角度看）在 ELF 文件的什么地方。稍安勿躁，快到了~")]),s._v(" "),a("p",[s._v("为了方便描述，后续部分把节和段全部统一称为节。")]),s._v(" "),a("p",[s._v("其实是这样的：一个 ELF 文件存在很多个节，这些节的具体信息由程序头表或者节头表描述。")]),s._v(" "),a("p",[s._v("以节头表为例：假如一个 ELF 文件共存在 4 个 Section--"),a("code",[s._v(".text")]),s._v("、"),a("code",[s._v(".rodata")]),s._v("、"),a("code",[s._v(".data")]),s._v(" 和 "),a("code",[s._v(".bss")]),s._v("，那么 节头表将会有 4 个表项（Entry）分别描述这 4 节的具体信息（严格来说，除了 4 个表项外还存在一些其他辅助的节），就像下面这样：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("       +------------------------------+\n       |       ELF header             |\n       +------------------------------+\n       |    Program header table      |\n       +------------------------------+\n       | +--------------------------+ |\n       | |     .text                +<--------+\n       | +--------------------------+ |       |\n       | +--------------------------+ |       |\n       | |     .rodata              +<----+   |\n       | +--------------------------+ |   |   |\n       | +--------------------------+ |   |   |\n    +---\x3e+     .data                | |   |   |\n    |  | +--------------------------+ |   |   |\n    |  | +--------------------------+ |   |   |\n+-------\x3e+     .bss                 | |   |   |\n|   |  | +--------------------------+ |   |   |\n|   |  +------------------------------+   |   |\n|   |  | +--------------------------+ |   |   |\n|   |  | | entry0: describe .text   +---------+\n|   |  | +--------------------------+ |   |\n|   |  | +--------------------------+ |   |\n|   |  | | entry1: describe .rodata +-----+\n|   |  | +--------------------------+ |\n|   |  | +--------------------------+ |\n|   +----+ entry2: describe .data   | |\n|      | +--------------------------+ |\n|      | +--------------------------+ |\n+--------+ entry3: describe .bss    | |\n       | +--------------------------+ |\n       +------------------------------+\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("h2",{attrs:{id:"示例程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例程序"}},[s._v("#")]),s._v(" 示例程序")]),s._v(" "),a("p",[s._v("为了加深理解，这里分析一个具体的代码示例，从字节码的粒度来解剖 ELF 文件结构。")]),s._v(" "),a("h3",{attrs:{id:"环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[s._v("#")]),s._v(" 环境")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"right"}},[s._v("软件")]),s._v(" "),a("th",{staticStyle:{"text-align":"left"}},[s._v("版本")])])]),s._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"right"}},[s._v("ubuntu")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("20.04")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"right"}},[s._v("gcc")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("9.3.0")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"right"}},[s._v("make")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("4.2.1")])])])]),s._v(" "),a("h3",{attrs:{id:"演示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#演示"}},[s._v("#")]),s._v(" 演示")]),s._v(" "),a("p",[s._v("程序的功能比较简单：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("  源文件                 动态库文件\n+----------+         +--------------+\n| mymath.c +--------\x3e+ libmymath.so +---+\n+----------+         +--------------+   |     +------+\n                                        +----\x3e+ main |\n+----------+         +--------------+   |     +------+\n|  main.c  +--------\x3e+    main.o    +---+     可执行文件\n+----------+         +--------------+\n  源文件                 目标文件\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// mymath.c")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("my_add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// main.c")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("<stdio.h>")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extern")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("my_add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" j "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" k "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("my_add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" j"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k = %d \\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("div",{staticClass:"language-makefile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-makefile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# makefile")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v(".PHONY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" all\n"),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" main libmymath.so\n\n"),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("libmymath.so")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mymath.c\n\tgcc "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$<")]),s._v(" -fPIC -shared -o "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("main.o")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" main.c\n\tgcc -c "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$<")]),s._v(" -o "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" main.o libmymath.so\n\tgcc main.o -L. -lmymath -o "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v(".PHONY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" clean\n"),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("clean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\trm *.o *.so main\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("由之前的描述可知：动态库文件 libmymath.so, 目标文件 main.o 和可执行文件 main 都是 ELF 文件，只不过属于不同的类型。")]),s._v(" "),a("p",[s._v("接下来拆解一下可执行文件 main。首先编译生成可执行文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后用指令 "),a("code",[s._v("readelf -h main")]),s._v(" 查看 main 文件的 ELF header 的信息。")]),s._v(" "),a("blockquote",[a("p",[s._v("readelf 是一个可以好好利用的工具。")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ELF Header:\n  Magic:   7f "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" 4c "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v(" 02 01 01 00 00 00 00 00 00 00 00 00\n  Class:                             ELF64\n  Data:                              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("'s complement, little endian\n  Version:                           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  OS/ABI:                            UNIX - System V\n  ABI Version:                       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  Type:                              DYN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Shared object "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  Machine:                           Advanced Micro Devices X86-64\n  Version:                           0x1\n  Entry point address:               0x1080\n  Start of program headers:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes into "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  Start of section headers:          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14744")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes into "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  Flags:                             0x0\n  Size of this header:               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  Size of program headers:           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  Number of program headers:         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("\n  Size of section headers:           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  Number of section headers:         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("\n  Section header string table index: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("上图显示了 ELF 头部描述的所有内容。这个内容与结构体 "),a("code",[s._v("Elf64_Ehdr")]),s._v(" 的成员变量是一一对应的！")]),s._v(" "),a("p",[s._v("由图可知，第 15 行显示的内容："),a("code",[s._v("Size of this header: 64 (bytes)")]),s._v("，表明 ELF header 部分的内容，一共是 64 字节。接下来我们看看开头的这 64 个字节码。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("od -Ax -t x1 -N "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" main\n\n000000 7f "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" 4c "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v(" 02 01 01 00 00 00 00 00 00 00 00 00\n000010 03 00 3e 00 01 00 00 00 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 00 00 00 00 00 00\n000020 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(" 00 00 00 00 00 00 00 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("98")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),s._v(" 00 00 00 00 00 00\n000030 00 00 00 00 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(" 00 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v(" 00 0d 00 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(" 00 1f 00 1e 00\n000040\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("简单解释一下 "),a("code",[s._v("od")]),s._v(" 工具的几个选项：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"right"}},[s._v("选项")]),s._v(" "),a("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"right"}},[a("code",[s._v("-Ax")])]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("显示地址的时候，用十六进制来表示。如果使用 "),a("code",[s._v("-Ad")]),s._v("，意思就是用十进制来显示地址")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"right"}},[a("code",[s._v("-t -x1")])]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("显示字节码内容的时候，使用十六进制（"),a("code",[s._v("x")]),s._v("），每次显示一个字节（1）")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"right"}},[a("code",[s._v("-N 64")])]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("只需要读取 64 个字节")])])])]),s._v(" "),a("p",[s._v("这 64 字节的内容可以一一对应到结构体 "),a("code",[s._v("Elf64_Ehdr")]),s._v(" 的每个字段。")]),s._v(" "),a("p",[s._v("先看字段 "),a("code",[s._v("e_ident")]),s._v(",")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("字节下标范围")]),s._v(" "),a("th",[s._v("值")]),s._v(" "),a("th",[s._v("说明")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0x7F")]),s._v(" "),a("td",[s._v("文件标识，必须为 0x7F")])]),s._v(" "),a("tr",[a("td",[s._v("1-3")]),s._v(" "),a("td",[s._v("0x45 4c 46")]),s._v(" "),a("td",[a("code",[s._v("ELF")]),s._v(" 字符串对应的 ASCII 码")])]),s._v(" "),a("tr",[a("td",[s._v("4")]),s._v(" "),a("td",[s._v("0x02")]),s._v(" "),a("td",[s._v("文件类型，0 表示非法，1 表示 32 位，2 表示 64 位")])]),s._v(" "),a("tr",[a("td",[s._v("5")]),s._v(" "),a("td",[s._v("0x01")]),s._v(" "),a("td",[s._v("编码格式，0 表示非法，1 表示小端，2 表示大端")])]),s._v(" "),a("tr",[a("td",[s._v("6")]),s._v(" "),a("td",[s._v("0x01")]),s._v(" "),a("td",[s._v("文件版本，0 表示非法，1 表示当前")])]),s._v(" "),a("tr",[a("td",[s._v("7")]),s._v(" "),a("td",[s._v("0x00")]),s._v(" "),a("td",[s._v("标记对象的目标系统和 ABI，0 和 1 均表示 "),a("code",[s._v("UNIX System V ABI")])])]),s._v(" "),a("tr",[a("td",[s._v("8")]),s._v(" "),a("td",[s._v("0x00")]),s._v(" "),a("td",[s._v("标记对象的目标 ABI 版本，具体解析方式依第 7 字节而定")])]),s._v(" "),a("tr",[a("td",[s._v("9-15")]),s._v(" "),a("td",[s._v("0x00 00 00 00 00 00 00")]),s._v(" "),a("td",[s._v("填充字节")])])])]),s._v(" "),a("p",[s._v("详情参见 "),a("a",{attrs:{href:"https://man7.org/linux/man-pages/man5/elf.5.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("p",[s._v("关于大端、小端格式，这个 "),a("code",[s._v("main")]),s._v(" 文件显示的是 1，代表小端格式。啥意思呢，看下面这张图就明白了：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("值")]),s._v(" "),a("th",[s._v("低地址 0")]),s._v(" "),a("th",[s._v("低地址 1")]),s._v(" "),a("th",[s._v("低地址 2")]),s._v(" "),a("th",[s._v("低地址 3")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("0x01")]),s._v(" "),a("td",[s._v("0x01")]),s._v(" "),a("td"),s._v(" "),a("td"),s._v(" "),a("td")]),s._v(" "),a("tr",[a("td",[s._v("0x0102")]),s._v(" "),a("td",[s._v("0x02")]),s._v(" "),a("td",[s._v("0x01")]),s._v(" "),a("td"),s._v(" "),a("td")]),s._v(" "),a("tr",[a("td",[s._v("0x010203")]),s._v(" "),a("td",[s._v("0x03")]),s._v(" "),a("td",[s._v("0x02")]),s._v(" "),a("td",[s._v("0x01")]),s._v(" "),a("td")]),s._v(" "),a("tr",[a("td",[s._v("0x01020304")]),s._v(" "),a("td",[s._v("0x04")]),s._v(" "),a("td",[s._v("0x03")]),s._v(" "),a("td",[s._v("0x02")]),s._v(" "),a("td",[s._v("0x01")])])])]),s._v(" "),a("p",[s._v("那么再来看一下大端格式：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("值")]),s._v(" "),a("th",[s._v("低地址 0")]),s._v(" "),a("th",[s._v("低地址 1")]),s._v(" "),a("th",[s._v("低地址 2")]),s._v(" "),a("th",[s._v("低地址 3")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("0x01")]),s._v(" "),a("td",[s._v("0x01")]),s._v(" "),a("td"),s._v(" "),a("td"),s._v(" "),a("td")]),s._v(" "),a("tr",[a("td",[s._v("0x0102")]),s._v(" "),a("td",[s._v("0x01")]),s._v(" "),a("td",[s._v("0x02")]),s._v(" "),a("td"),s._v(" "),a("td")]),s._v(" "),a("tr",[a("td",[s._v("0x010203")]),s._v(" "),a("td",[s._v("0x01")]),s._v(" "),a("td",[s._v("0x02")]),s._v(" "),a("td",[s._v("0x03")]),s._v(" "),a("td")]),s._v(" "),a("tr",[a("td",[s._v("0x01020304")]),s._v(" "),a("td",[s._v("0x01")]),s._v(" "),a("td",[s._v("0x02")]),s._v(" "),a("td",[s._v("0x03")]),s._v(" "),a("td",[s._v("0x04")])])])]),s._v(" "),a("p",[s._v("接下来继续把剩下的 48 字节（64 - 16 = 48），也以这样的字节码含义画出来：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("字段")]),s._v(" "),a("th",[s._v("字节范围")]),s._v(" "),a("th",[s._v("值")]),s._v(" "),a("th",[s._v("说明")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("e_type")]),s._v(" "),a("td",[s._v("16-17")]),s._v(" "),a("td",[s._v("0x03 00")]),s._v(" "),a("td",[s._v("3 表示共享对象文件，比 2 表示的可执行文件更加安全，因为多了 "),a("a",{attrs:{href:"https://stackoverflow.com/questions/30555248/readelf-reports-program-is-a-shared-library-instead-of-executable",target:"_blank",rel:"noopener noreferrer"}},[s._v("PIE"),a("OutboundLink")],1)])]),s._v(" "),a("tr",[a("td",[s._v("e_machine")]),s._v(" "),a("td",[s._v("18-19")]),s._v(" "),a("td",[s._v("0x3e 00")]),s._v(" "),a("td",[s._v("Advanced Micro Devices X86-64")])]),s._v(" "),a("tr",[a("td",[s._v("e_version")]),s._v(" "),a("td",[s._v("20-23")]),s._v(" "),a("td",[s._v("0x01 00 00 00")]),s._v(" "),a("td",[s._v("1 表示非法版本，2 表示当前版本")])]),s._v(" "),a("tr",[a("td",[s._v("e_entry")]),s._v(" "),a("td",[s._v("24-31")]),s._v(" "),a("td",[s._v("0x80 10 00 00 00 00 00 00")]),s._v(" "),a("td",[s._v("程序的入口地址")])]),s._v(" "),a("tr",[a("td",[s._v("e_phoff")]),s._v(" "),a("td",[s._v("32-39")]),s._v(" "),a("td",[s._v("0x40 00 00 00 00 00 00 00")]),s._v(" "),a("td",[s._v("program header table 在 ELF 文件的偏移量。0x40=64 表示从第 64 字节开始就是程序头表")])]),s._v(" "),a("tr",[a("td",[s._v("e_shoff")]),s._v(" "),a("td",[s._v("40-47")]),s._v(" "),a("td",[s._v("0x98 39 00 00 00 00 00 00")]),s._v(" "),a("td",[s._v("section header table 在 ELF 文件的偏移量。0x3998=14744 表示从第 14744 字节开始就是节头表")])]),s._v(" "),a("tr",[a("td",[s._v("e_flags")]),s._v(" "),a("td",[s._v("48-51")]),s._v(" "),a("td",[s._v("0x00 00 00 00")]),s._v(" "),a("td",[s._v("处理器相关标识")])]),s._v(" "),a("tr",[a("td",[s._v("e_ehsize")]),s._v(" "),a("td",[s._v("52-53")]),s._v(" "),a("td",[s._v("0x40 00")]),s._v(" "),a("td",[s._v("ELF 头部的字节数")])]),s._v(" "),a("tr",[a("td",[s._v("e_phentsize")]),s._v(" "),a("td",[s._v("54-55")]),s._v(" "),a("td",[s._v("0x38 00")]),s._v(" "),a("td",[s._v("程序头表每个表项的字节长度为 0x38=56")])]),s._v(" "),a("tr",[a("td",[s._v("e_phnum")]),s._v(" "),a("td",[s._v("56-57")]),s._v(" "),a("td",[s._v("0x0d 00")]),s._v(" "),a("td",[s._v("程序头表的表项总数为 0x0b=10")])]),s._v(" "),a("tr",[a("td",[s._v("e_shentsize")]),s._v(" "),a("td",[s._v("58-59")]),s._v(" "),a("td",[s._v("0x40 00")]),s._v(" "),a("td",[s._v("节头表种每个表项的字节长度为 0x40=64")])]),s._v(" "),a("tr",[a("td",[s._v("e_shnum")]),s._v(" "),a("td",[s._v("60-61")]),s._v(" "),a("td",[s._v("0x1f 00")]),s._v(" "),a("td",[s._v("节头表的表项总数为 0x1f=31")])]),s._v(" "),a("tr",[a("td",[s._v("e_shstrndx")]),s._v(" "),a("td",[s._v("62-63")]),s._v(" "),a("td",[s._v("0x1e 00")]),s._v(" "),a("td",[s._v("字符串表项在节头表的索引为 0x1e=30")])])])]),s._v(" "),a("h3",{attrs:{id:"字符串表项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#字符串表项"}},[s._v("#")]),s._v(" 字符串表项")]),s._v(" "),a("p",[s._v("在一个 ELF 文件中，存在很多字符串，例如：变量名、节名称、链接器加入的符号等等。这些字符串的长度都是不固定的，因此用一个固定的结构来表示这些字符串肯定是不现实的。于是，聪明的人类就想到：把这些字符串集中放在一起，作为一个独立的节管理。文件的其他地方如果想表示一个字符串，就在这个地方写一个数字索引：表示这个字符串位于字符串统一存储地方的某个偏移位置。经过这样的按图索骥，就可以找到具体的字符串了。")]),s._v(" "),a("p",[s._v("比如说啊，下面这个空间中存储了所有的字符串：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("偏移")]),s._v(" "),a("th",[s._v("00")]),s._v(" "),a("th",[s._v("01")]),s._v(" "),a("th",[s._v("02")]),s._v(" "),a("th",[s._v("03")]),s._v(" "),a("th",[s._v("04")]),s._v(" "),a("th",[s._v("05")]),s._v(" "),a("th",[s._v("06")]),s._v(" "),a("th",[s._v("07")]),s._v(" "),a("th",[s._v("08")]),s._v(" "),a("th",[s._v("09")]),s._v(" "),a("th",[s._v("10")]),s._v(" "),a("th",[s._v("11")]),s._v(" "),a("th",[s._v("12")]),s._v(" "),a("th",[s._v("13")]),s._v(" "),a("th",[s._v("14")]),s._v(" "),a("th",[s._v("15")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("00")]),s._v(" "),a("td",[s._v("\\0")]),s._v(" "),a("td",[s._v(".")]),s._v(" "),a("td",[s._v("t")]),s._v(" "),a("td",[s._v("e")]),s._v(" "),a("td",[s._v("x")]),s._v(" "),a("td",[s._v("t")]),s._v(" "),a("td",[s._v("\\0")]),s._v(" "),a("td",[s._v(".")]),s._v(" "),a("td",[s._v("d")]),s._v(" "),a("td",[s._v("a")]),s._v(" "),a("td",[s._v("t")]),s._v(" "),a("td",[s._v("a")]),s._v(" "),a("td",[s._v("\\0")]),s._v(" "),a("td",[s._v("h")]),s._v(" "),a("td",[s._v("e")]),s._v(" "),a("td",[s._v("l")])]),s._v(" "),a("tr",[a("td",[s._v("16")]),s._v(" "),a("td",[s._v("l")]),s._v(" "),a("td",[s._v("o")]),s._v(" "),a("td",[s._v(",")]),s._v(" "),a("td",[s._v("w")]),s._v(" "),a("td",[s._v("o")]),s._v(" "),a("td",[s._v("r")]),s._v(" "),a("td",[s._v("l")]),s._v(" "),a("td",[s._v("d")]),s._v(" "),a("td",[s._v("!")]),s._v(" "),a("td",[s._v("\\0")]),s._v(" "),a("td",[s._v(".")]),s._v(" "),a("td",[s._v("r")]),s._v(" "),a("td",[s._v("o")]),s._v(" "),a("td",[s._v("d")]),s._v(" "),a("td",[s._v("a")]),s._v(" "),a("td",[s._v("t")])]),s._v(" "),a("tr",[a("td",[s._v("32")]),s._v(" "),a("td",[s._v("a")]),s._v(" "),a("td",[s._v("\\0")]),s._v(" "),a("td",[s._v(".")]),s._v(" "),a("td",[s._v("b")]),s._v(" "),a("td",[s._v("s")]),s._v(" "),a("td",[s._v("s")]),s._v(" "),a("td",[s._v("\\0")]),s._v(" "),a("td"),s._v(" "),a("td"),s._v(" "),a("td"),s._v(" "),a("td"),s._v(" "),a("td"),s._v(" "),a("td"),s._v(" "),a("td"),s._v(" "),a("td"),s._v(" "),a("td")])])]),s._v(" "),a("p",[s._v("在程序的其他地方，如果想引用字符串 "),a("code",[s._v("hello,world!")]),s._v("，那么就只需要在那个地方标明数字 13 就可以了，表示：这个字符串从偏移 13 个字节处开始。")]),s._v(" "),a("p",[s._v("那么现在，咱们再回到这个 main 文件的字符串表，")]),s._v(" "),a("p",[s._v("ELF 头的最后 2 个字节是 0x1e 0x00，对应结构体的成员 "),a("code",[s._v("e_shstrndx")]),s._v("，意思是这个 ELF 文件中，字符串表是一个普通的节，存储了 ELF 文件使用到的所有字符串。既然是一个节，那么节头表就一定有一个表项来描述它，那么是哪一个表项呢？这就是第 LE(0x1e00)=30 个表项。")]),s._v(" "),a("p",[s._v("可以用指令 "),a("code",[s._v("readelf -S main")]),s._v(" 来看一下这个 ELF 文件的所有节信息，可见其中第 30 个节描述的正是字符串表节")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("There are "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" section headers, starting at offset 0x3998:\n\nSection Headers:\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Nr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Name              Type             Address           Offset\n       Size              EntSize          Flags  Link  Info  Align\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                   NULL             0000000000000000  00000000\n       0000000000000000  0000000000000000           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .interp           PROGBITS         0000000000000318  00000318\n       000000000000001c  0000000000000000   A       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .note.gnu.propert NOTE             0000000000000338  00000338\n       0000000000000020  0000000000000000   A       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .note.gnu.build-i NOTE             0000000000000358  00000358\n       0000000000000024  0000000000000000   A       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .note.ABI-tag     NOTE             000000000000037c  0000037c\n       0000000000000020  0000000000000000   A       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .gnu.hash         GNU_HASH         00000000000003a0  000003a0\n       0000000000000024  0000000000000000   A       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .dynsym           DYNSYM           00000000000003c8  000003c8\n       00000000000000c0  0000000000000018   A       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .dynstr           STRTAB           0000000000000488  00000488\n       0000000000000098  0000000000000000   A       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .gnu.version      VERSYM           0000000000000520  00000520\n       0000000000000010  0000000000000002   A       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .gnu.version_r    VERNEED          0000000000000530  00000530\n       0000000000000020  0000000000000000   A       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .rela.dyn         RELA             0000000000000550  00000550\n       00000000000000c0  0000000000000018   A       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .rela.plt         RELA             0000000000000610  00000610\n       0000000000000030  0000000000000018  AI       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .init             PROGBITS         0000000000001000  00001000\n       000000000000001b  0000000000000000  AX       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .plt              PROGBITS         0000000000001020  00001020\n       0000000000000030  0000000000000010  AX       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .plt.got          PROGBITS         0000000000001050  00001050\n       0000000000000010  0000000000000010  AX       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .plt.sec          PROGBITS         0000000000001060  00001060\n       0000000000000020  0000000000000010  AX       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .text             PROGBITS         0000000000001080  00001080\n       00000000000001b5  0000000000000000  AX       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .fini             PROGBITS         0000000000001238  00001238\n       000000000000000d  0000000000000000  AX       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .rodata           PROGBITS         0000000000002000  00002000\n       000000000000000d  0000000000000000   A       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .eh_frame_hdr     PROGBITS         0000000000002010  00002010\n       0000000000000044  0000000000000000   A       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .eh_frame         PROGBITS         0000000000002058  00002058\n       0000000000000108  0000000000000000   A       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .init_array       INIT_ARRAY       0000000000003da0  00002da0\n       0000000000000008  0000000000000008  WA       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .fini_array       FINI_ARRAY       0000000000003da8  00002da8\n       0000000000000008  0000000000000008  WA       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .dynamic          DYNAMIC          0000000000003db0  00002db0\n       0000000000000200  0000000000000010  WA       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .got              PROGBITS         0000000000003fb0  00002fb0\n       0000000000000050  0000000000000008  WA       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .data             PROGBITS         0000000000004000  00003000\n       0000000000000010  0000000000000000  WA       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .bss              NOBITS           0000000000004010  00003010\n       0000000000000008  0000000000000000  WA       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .comment          PROGBITS         0000000000000000  00003010\n       000000000000002a  0000000000000001  MS       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .symtab           SYMTAB           0000000000000000  00003040\n       0000000000000630  0000000000000018          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .strtab           STRTAB           0000000000000000  00003670\n       000000000000020b  0000000000000000           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .shstrtab         STRTAB           0000000000000000  0000387b\n       000000000000011a  0000000000000000           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nKey to Flags:\n  W "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("write"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", A "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("alloc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", X "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("execute"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", M "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("merge"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", S "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("strings"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", I "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n  L "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("link order"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", O "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("extra OS processing required"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", G "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("group"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", T "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TLS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n  C "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("compressed"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", x "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("unknown"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", o "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("OS specific"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", E "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("exclude"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n  l "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("large"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", p "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("processor specific"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br")])]),a("p",[s._v("可以看出来：这个节在 ELF 文件的偏移地址是 0x000387b，长度是 0x000000000000011a 字节。")]),s._v(" "),a("p",[s._v("下面从 ELF 头部的二进制数据解析出这些信息。")]),s._v(" "),a("h3",{attrs:{id:"读取字符串表节的内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#读取字符串表节的内容"}},[s._v("#")]),s._v(" 读取字符串表节的内容")]),s._v(" "),a("p",[s._v("本节演示如何借助 ELF 头部提供的信息，把字符串表这个节给找出来，然后把它的字节码打印出来看看。")]),s._v(" "),a("p",[s._v("要想打印字符串表节的内容，就必须知道这个节在 ELF 文件的偏移地址。而偏移地址可从节头表的第 30 个表项的描述信息获取。要想知道第 30 个表项的地址，就必须知道节头表在 ELF 文件的开始地址，以及每一个表项的大小。")]),s._v(" "),a("p",[s._v("ELF 头部给出了最后这两个需求信息，因此可反推算出 "),a("code",[s._v("shstrtab")]),s._v(" 的偏移地址。ELF 头部的第 32 到 35 字节内容是：14744=LE(0x9839000000000000)（注意这里的字节序，低位在前）表示的就是节头表在 ELF 文件的开始地址 "),a("code",[s._v("e_shoff")]),s._v(" 位于 ELF 文件的第 14744 字节处。知道了开始地址，再来算一下第 30 个表项的地址。ELF 头部第 58-59 字节的内容是 0x4000，表示每个表项的长度 "),a("code",[s._v("e_shentsize")]),s._v(" 是 LE(0x0040)=64 字节。")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"},[s._v("温馨提示")]),a("p",[s._v("这里的计算都是从 0 开始的，因此第 30 个表项的开始地址就是：14744 + 30 * 64 = 16664，也就是说描述字符串表这个节的表项位于 ELF 文件的 16664 字节的位置。")])]),a("p",[s._v("既然知道了这个表项的地址，那么就扒开来看一下其中的二进制内容：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("od -Ad -t x1 -j "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16664")]),s._v(" -N "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" main\n\n0016664 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" 00 00 00 03 00 00 00 00 00 00 00 00 00 00 00\n0016680 00 00 00 00 00 00 00 00 7b "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v(" 00 00 00 00 00 00\n0016696 1a 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n0016712 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n0016728\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("其中的 "),a("code",[s._v("-j 16664")]),s._v(" 选项，表示跳过前面的 16664 个字节，也就是从 main 这个 ELF 文件的 16664 字节处开始读取，一共读 64 字节。")]),s._v(" "),a("p",[s._v("这 64 个字节的内容，就对应了 "),a("code",[s._v("Elf64_Shdr")]),s._v(" 结构体的每个成员变量：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v("   sh_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v("   sh_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint64_t")]),s._v("   sh_flags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  Elf64_Addr sh_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  Elf64_Off  sh_offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint64_t")]),s._v("   sh_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v("   sh_link"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v("   sh_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint64_t")]),s._v("   sh_addralign"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint64_t")]),s._v("   sh_entsize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" Elf64_Shdr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("这里重点讲一下以下 4 个字段:")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("字段")]),s._v(" "),a("th",[s._v("值")]),s._v(" "),a("th",[s._v("说明")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("sh_name")]),s._v(" "),a("td",[s._v("0x11 00 00 00")]),s._v(" "),a("td",[s._v("暂且按住不表，马上就解释到了")])]),s._v(" "),a("tr",[a("td",[s._v("sh_type")]),s._v(" "),a("td",[s._v("0x03 00 00 00")]),s._v(" "),a("td",[s._v("类型，3 表示这是一个字符串表")])]),s._v(" "),a("tr",[a("td",[s._v("sh_offset")]),s._v(" "),a("td",[s._v("0x7b 38 00 00 00 00 00 00")]),s._v(" "),a("td",[s._v("在 ELF 文件的偏移量。LE(0x7b38000000000000) = 14459，表示字符串表这个 Section 从 ELF 文件的 14459 字节处开始")])]),s._v(" "),a("tr",[a("td",[s._v("sh_size")]),s._v(" "),a("td",[s._v("0x1a 01 00 00 00 00 00 00")]),s._v(" "),a("td",[s._v("长度为 LE(0x1a01000000000000) = 282 字节")])])])]),s._v(" "),a("p",[s._v("还记得刚才我们使用 readelf 工具，读取到字符串表 Section 在 ELF 文件中的偏移地址是 LE(0x7b38000000000000)，长度是 LE(0x1a01000000000000) 字节吗？与我们这里的推断所得完全一致！")]),s._v(" "),a("p",[s._v("既然知道了字符串表这个节在 ELF 文件的偏移量以及长度，那么就可以把它的字节码内容读取出来看看了。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("od -Ad -t c -j "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14459")]),s._v(" -N "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("282")]),s._v(" main\n\n0014459  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   s   y   m   t   a   b  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   s   t   r   t   a   b\n0014475  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   s   h   s   t   r   t   a   b  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   i   n   t   e\n0014491   r   p  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   n   o   t   e   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   g   n   u   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   p   r   o\n0014507   p   e   r   t   y  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   n   o   t   e   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   g   n   u   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n0014523   b   u   i   l   d   -   i   d  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   n   o   t   e   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   A\n0014539   B   I   -   t   a   g  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   g   n   u   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   h   a   s   h\n0014555  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   d   y   n   s   y   m  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   d   y   n   s   t   r\n0014571  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   g   n   u   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("v")]),s._v("   e   r   s   i   o   n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   g\n0014587   n   u   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("v")]),s._v("   e   r   s   i   o   n   _   r  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   r   e\n0014603   l   a   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   d   y   n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   r   e   l   a   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   p   l   t\n0014619  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   i   n   i   t  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   p   l   t   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   g   o   t  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n0014635   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   p   l   t   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   s   e   c  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   t   e   x   t  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n0014651   f   i   n   i  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   r   o   d   a   t   a  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   e   h\n0014667   _   f   r   a   m   e   _   h   d   r  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   e   h   _   f\n0014683   r   a   m   e  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   i   n   i   t   _   a   r   r   a   y\n0014699  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   f   i   n   i   _   a   r   r   a   y  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   d   y\n0014715   n   a   m   i   c  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   d   a   t   a  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   b   s   s\n0014731  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   c   o   m   m   e   n   t  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n0014741\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("看一看，瞧一瞧，是不是这个节中存储的全部是字符串？")]),s._v(" "),a("p",[s._v("刚才没有解释 "),a("code",[s._v("sh_name")]),s._v(" 这个字段，它表示字符串表这个节本身的名字。既然是名字，那一定是个字符串。但是这个字符串不是直接存储在这里的，而是存储了一个值为 0x00000011=17 的索引。现在数一下字符串表节的第 17 个字节开始的地方，可见 "),a("code",[s._v(".shstrtab")]),s._v(" 这个字符串（"),a("code",[s._v("\\0")]),s._v(" 是字符串的分隔符）！")]),s._v(" "),a("h3",{attrs:{id:"读取代码段的内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#读取代码段的内容"}},[s._v("#")]),s._v(" 读取代码段的内容")]),s._v(" "),a("p",[s._v("从下面的这张图（指令："),a("code",[s._v("readelf -S main")]),s._v("）：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("There are "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" section headers, starting at offset 0x3998:\n\nSection Headers:\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Nr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Name              Type             Address           Offset\n       Size              EntSize          Flags  Link  Info  Align\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .plt.sec          PROGBITS         0000000000001060  00001060\n       0000000000000020  0000000000000010  AX       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .text             PROGBITS         0000000000001080  00001080\n       00000000000001b5  0000000000000000  AX       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .fini             PROGBITS         0000000000001238  00001238\n       000000000000000d  0000000000000000  AX       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("可以看到代码段是位于第 16 个表项 "),a("code",[s._v(".text")]),s._v(" 中，加载（虚拟）地址是 0x0000000000001080，它位于 ELF 文件的偏移量是 0x00001080，长度是 0x00000000000001b5 字节。")]),s._v(" "),a("p",[s._v("接下来解析一下其对应的二进制内容。首先计算这个表项的地址：14744 + 16 * 64 = 15768，然后读取这个表项的头部信息")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("od -Ad -t x1 -j "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15768")]),s._v(" -N "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" main\n\n0015768 b9 00 00 00 01 00 00 00 06 00 00 00 00 00 00 00\n0015784 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 00 00 00 00 00 00 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 00 00 00 00 00 00\n0015800 b5 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n0015816 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n0015832\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("重点关注下面这 5 个字段")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v("   sh_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v("   sh_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint64_t")]),s._v("   sh_flags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  Elf64_Addr sh_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  Elf64_Off  sh_offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint64_t")]),s._v("   sh_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v("   sh_link"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v("   sh_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint64_t")]),s._v("   sh_addralign"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint64_t")]),s._v("   sh_entsize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" Elf64_Shdr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("table",[a("thead",[a("tr",[a("th",[s._v("字段")]),s._v(" "),a("th",[s._v("值（小端存储）")]),s._v(" "),a("th",[s._v("说明")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("sh_name")]),s._v(" "),a("td",[s._v("0xb9 00 00 00")]),s._v(" "),a("td",[s._v("代码段名称在字符串表节的偏移位置。LE(0xb9000000)=185 字节，也就是在字符串表的第 185 字节处，存储的就是代码段的名字。回过头去找一下，看一下是不是字符串 "),a("code",[s._v(".text")])])]),s._v(" "),a("tr",[a("td",[s._v("sh_type")]),s._v(" "),a("td",[s._v("0x01 00 00 00")]),s._v(" "),a("td",[s._v("类型，"),a("code",[s._v("SHT_PROGBITS=1")]),s._v(" 表示这是代码")])]),s._v(" "),a("tr",[a("td",[s._v("sh_addr")]),s._v(" "),a("td",[s._v("0x80 10 00 00 00 00 00 00")]),s._v(" "),a("td",[s._v("加载的虚拟地址，与 ELF header 的 "),a("code",[s._v("e_entry")]),s._v(" 字段的值是相同的")])]),s._v(" "),a("tr",[a("td",[s._v("sh_offset")]),s._v(" "),a("td",[s._v("0x80 10 00 00 00 00 00 00")]),s._v(" "),a("td",[s._v("在 ELF 文件的偏移量。LE(0x8010000000000000)=4224，意思是内容从 ELF 文件的 4224 字节处开始")])]),s._v(" "),a("tr",[a("td",[s._v("sh_size")]),s._v(" "),a("td",[s._v("0xb5 01 00 00 00 00 00 00")]),s._v(" "),a("td",[s._v("长度为 LE(0xb501000000000000)=437 字节")])])])]),s._v(" "),a("p",[s._v("以上这些分析结果与指令 "),a("code",[s._v("readelf -S main")]),s._v(" 读取出来的完全一样！")]),s._v(" "),a("p",[s._v("根据这些信息，我们可以读取代码段的字节码 如下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("od -Ad -t x1 -j "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4224")]),s._v(" -N "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("437")]),s._v(" main\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这里就不贴输出的黑乎乎字节码了。")]),s._v(" "),a("h2",{attrs:{id:"程序头-program-header"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#程序头-program-header"}},[s._v("#")]),s._v(" 程序头（Program header）")]),s._v(" "),a("p",[s._v("文章开头就介绍了 ELF 是一个通用的文件结构，链接器和加载器在看待 ELF 的角度是不同的。为了对程序头有更感性的认识，我们先用 readelf 工具从总体上看一下 main 文件的所有段信息。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("readelf -l main\n\nElf "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" is DYN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Shared object "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nEntry point 0x1080\nThere are "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" program headers, starting at offset "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n\nProgram Headers:\n  Type           Offset             VirtAddr           PhysAddr\n                 FileSiz            MemSiz              Flags  Align\n  PHDR           0x0000000000000040 0x0000000000000040 0x0000000000000040\n                 0x00000000000002d8 0x00000000000002d8  R      0x8\n  INTERP         0x0000000000000318 0x0000000000000318 0x0000000000000318\n                 0x000000000000001c 0x000000000000001c  R      0x1\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Requesting program interpreter: /lib64/ld-linux-x86-64.so.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  LOAD           0x0000000000000000 0x0000000000000000 0x0000000000000000\n                 0x0000000000000640 0x0000000000000640  R      0x1000\n  LOAD           0x0000000000001000 0x0000000000001000 0x0000000000001000\n                 0x0000000000000245 0x0000000000000245  R E    0x1000\n  LOAD           0x0000000000002000 0x0000000000002000 0x0000000000002000\n                 0x0000000000000160 0x0000000000000160  R      0x1000\n  LOAD           0x0000000000002da0 0x0000000000003da0 0x0000000000003da0\n                 0x0000000000000270 0x0000000000000278  RW     0x1000\n  DYNAMIC        0x0000000000002db0 0x0000000000003db0 0x0000000000003db0\n                 0x0000000000000200 0x0000000000000200  RW     0x8\n  NOTE           0x0000000000000338 0x0000000000000338 0x0000000000000338\n                 0x0000000000000020 0x0000000000000020  R      0x8\n  NOTE           0x0000000000000358 0x0000000000000358 0x0000000000000358\n                 0x0000000000000044 0x0000000000000044  R      0x4\n  GNU_PROPERTY   0x0000000000000338 0x0000000000000338 0x0000000000000338\n                 0x0000000000000020 0x0000000000000020  R      0x8\n  GNU_EH_FRAME   0x0000000000002010 0x0000000000002010 0x0000000000002010\n                 0x0000000000000044 0x0000000000000044  R      0x4\n  GNU_STACK      0x0000000000000000 0x0000000000000000 0x0000000000000000\n                 0x0000000000000000 0x0000000000000000  RW     0x10\n  GNU_RELRO      0x0000000000002da0 0x0000000000003da0 0x0000000000003da0\n                 0x0000000000000260 0x0000000000000260  R      0x1\n\n Section to Segment mapping:\n  Segment Sections"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n   00\n   01     .interp\n   02     .interp .note.gnu.property .note.gnu.build-id .note.ABI-tag .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt\n   03     .init .plt .plt.got .plt.sec .text .fini\n   04     .rodata .eh_frame_hdr .eh_frame\n   05     .init_array .fini_array .dynamic .got .data .bss\n   06     .dynamic\n   07     .note.gnu.property\n   08     .note.gnu.build-id .note.ABI-tag\n   09     .note.gnu.property\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("     .eh_frame_hdr\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("     .init_array .fini_array .dynamic .got\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br")])]),a("p",[s._v("由输出可得以下信息")]),s._v(" "),a("ul",[a("li",[s._v("这是一个共享对象文件")]),s._v(" "),a("li",[s._v("入口地址是 0x1080")]),s._v(" "),a("li",[s._v("共有 13 个 Program header，从 ELF 文件的 64 字节偏移地址开始")])]),s._v(" "),a("p",[s._v("布局如下图所示：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("+----------------------+\n|    ELF header        |\n+----------------------+\n+----------------------+\n|  +----------------+------\x3e 偏移 64 字节\n|  | PHDR           |  |  每个表项 56 字节\n|  +----------------+  |\n|  | INTERP         |  |\n|  +----------------+------\x3e 偏移 176=64+56*2\n|  | LOAD           |  |\n|  +----------------+  |\n|  | LOAD           |  |\n|  +----------------+  |\n|  | LOAD           |  |\n|  +----------------+  |\n|  | LOAD           |  |\n|  +----------------+  |\n|  | DYNAMIC        |  |\n|  +----------------+  |\n|  | NOTE           |  |\n|  +----------------+  |\n|  | NOTE           |  |\n|  +----------------+  |\n|  | GNU_PROPERTY   |  |\n|  +----------------+  |\n|  | GNU_EH_FRAME   |  |\n|  +----------------+  |\n|  | GNU_STACK      |  |\n|  +----------------+  |\n|  | GNU_RELRO      |  |\n|  +----------------+  |\n+----------------------+\n+----------------------+\n|    Segments          |\n+----------------------+\n+----------------------+\n| Section header table |\n+----------------------+\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br")])]),a("p",[s._v("开头还说过：节与段本质上是一样的，可以理解为一个段由一个或多个节组成。")]),s._v(" "),a("p",[s._v("从上图可以看到，第 2 个程序头这个段由那么多的 Section 组成。还可以看到，一共有 4 个 "),a("code",[s._v("LOAD")]),s._v(" 类型的段：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Requesting program interpreter: /lib64/ld-linux-x86-64.so.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  LOAD           0x0000000000000000 0x0000000000000000 0x0000000000000000\n                 0x0000000000000640 0x0000000000000640  R      0x1000\n  LOAD           0x0000000000001000 0x0000000000001000 0x0000000000001000\n                 0x0000000000000245 0x0000000000000245  R E    0x1000\n  LOAD           0x0000000000002000 0x0000000000002000 0x0000000000002000\n                 0x0000000000000160 0x0000000000000160  R      0x1000\n  LOAD           0x0000000000002da0 0x0000000000003da0 0x0000000000003da0\n                 0x0000000000000270 0x0000000000000278  RW     0x1000\n  DYNAMIC        0x0000000000002db0 0x0000000000003db0 0x0000000000003db0\n                 0x0000000000000200 0x0000000000000200  RW     0x8\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("我们读取第一个 "),a("code",[s._v("LOAD")]),s._v(" 类型的段，扒开其中的二进制字节码瞅瞅。")]),s._v(" "),a("p",[s._v("第一步的工作：计算这个段表项的地址信息。从 ELF 头得知如下信息：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"right"}},[s._v("字段")]),s._v(" "),a("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"right"}},[s._v("e_phoff")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("程序头表位于 ELF 文件偏移 64 字节的地方")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"right"}},[s._v("e_phentsize")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("每一个表项的长度是 56 字节")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"right"}},[s._v("e_phnum")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("共有 10 个表项")])])])]),s._v(" "),a("p",[s._v("通过计算，得到可读、可执行的 "),a("code",[s._v("LOAD")]),s._v(" 段（第 3 个程序表项）位于偏移量 176=64+56*2 字节处。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("od -Ad -t x1 -j "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("176")]),s._v(" -N "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(" main\n\n0000176 01 00 00 00 04 00 00 00 00 00 00 00 00 00 00 00\n0000192 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n0000208 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(" 06 00 00 00 00 00 00 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(" 06 00 00 00 00 00 00\n0000224 00 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 00 00 00 00 00 00\n0000232\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("按照惯例把其中几个需要关注的字段与数据结构的成员变量对照看一下：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v("   p_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v("   p_flags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  Elf64_Off  p_offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  Elf64_Addr p_vaddr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  Elf64_Addr p_paddr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint64_t")]),s._v("   p_filesz"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint64_t")]),s._v("   p_memsz"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint64_t")]),s._v("   p_align"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" Elf64_Phdr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("table",[a("thead",[a("tr",[a("th",[s._v("字段")]),s._v(" "),a("th",[s._v("值（小端存储）")]),s._v(" "),a("th",[s._v("说明")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("p_type")]),s._v(" "),a("td",[s._v("0x01 00 00 00")]),s._v(" "),a("td",[s._v("段的类型，1 表示这个段需要加载到内存")])]),s._v(" "),a("tr",[a("td",[s._v("p_flags")]),s._v(" "),a("td",[s._v("0x04 00 00 00")]),s._v(" "),a("td",[s._v("位掩码，"),a("code",[s._v("04=PF_X")]),s._v(" 表示这是个可执行段")])]),s._v(" "),a("tr",[a("td",[s._v("p_offset")]),s._v(" "),a("td",[s._v("0x00 00 00 00 00 00 00 00")]),s._v(" "),a("td",[s._v("段在 ELF 文件的偏移地址，0 表示这个段从 ELF 文件的头部开始")])]),s._v(" "),a("tr",[a("td",[s._v("p_vaddr")]),s._v(" "),a("td",[s._v("0x00 00 00 00 00 00 00 00")]),s._v(" "),a("td",[s._v("段加载到内存的虚拟地址 0")])]),s._v(" "),a("tr",[a("td",[s._v("p_paddr")]),s._v(" "),a("td",[s._v("0x00 00 00 00 00 00 00 00")]),s._v(" "),a("td",[s._v("段加载的物理地址，与虚拟地址相同")])]),s._v(" "),a("tr",[a("td",[s._v("p_filesz")]),s._v(" "),a("td",[s._v("0x40 06 00 00 00 00 00 00")]),s._v(" "),a("td",[s._v("这个段在 ELF 文件占据的字节数，LE(0x0640)=1600 字节")])]),s._v(" "),a("tr",[a("td",[s._v("p_memsz")]),s._v(" "),a("td",[s._v("0x40 06 00 00 00 00 00 00")]),s._v(" "),a("td",[s._v("这个段加载到内存需要占据的字节数，LE(0x0640)=1600 字节")])])])]),s._v(" "),a("blockquote",[a("p",[s._v("注意：有些段是不需要加载到内存中的;")])]),s._v(" "),a("p",[s._v("由上述分析可知：从 ELF 文件的 1 到 1600 字节都属于这个 "),a("code",[s._v("LOAD")]),s._v(" 段的内容。被执行时，这个段需要被加载到内存中虚拟地址为 0 的地方，从这里开始，又是一个全新的故事了。")]),s._v(" "),a("h2",{attrs:{id:"小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),a("p",[s._v("本文两个重点：")]),s._v(" "),a("ul",[a("li",[s._v("ELF 头描述文件的总体信息，以及两个表（程序头表和节头表）的相关信息（偏移地址，表项个数，表项长度）")]),s._v(" "),a("li",[s._v("每一个表包括很多个表项，每一个表项都描述一个节/段的具体信息")])]),s._v(" "),a("p",[s._v("链接器和加载器也都是按照这样的原理来解析 ELF 文件的。")]),s._v(" "),a("h2",{attrs:{id:"参考文献"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文献"}},[s._v("#")]),s._v(" 参考文献")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://man7.org/linux/man-pages/man5/elf.5.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("elf(5) — linux manual page"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.toutiao.com/i6982736574626660872/?tt_from=weixin&utm_campaign=client_share&wxshare_count=1&timestamp=1625875430&app=news_article&utm_source=weixin&utm_medium=toutiao_android&use_new_style=1&req_id=2021071008035001013516808335284E69&share_token=b34f88c9-9107-4600-8850-bd1599e87b73&group_id=6982736574626660872&wid=1625992706756",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux 系统中编译、链接的基石-ELF 文件：扒开它的层层外衣，从字节码的粒度来探索"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports}}]);