(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{809:function(s,a,t){"use strict";t.r(a);var n=t(6),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"背景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),t("p",[s._v("由于在线支付和互联网的发展，在手机和互联网电视领域，甚至物联网领域安全越来越显得重要。而 android 一直被诟病的就是运行速度慢和安全问题。关于安全问题，这点无可厚非，谁叫 android 是开源的呢？由于安全问题的严重性，google 规定在 android 7.0 之后要求厂商必须使用 TEE 来保护用户的生物特征数据（指纹，虹膜等）。")]),s._v(" "),t("p",[s._v("为确保用户的数据的安全，ARM 公司提出了 trustzone 技术，个人将 trustzone 理解为 cortex 的虚拟化技术。ARM 在 AXI 系统总线上添加了一根额外的安全总线，称为 NS 位，并将 cortex 分为两种状态：secure world 和 non-secure world，并添加了一种叫做 monitor 的模式，cortex 根据 NS 的值来判定当前指令操作是需要安全操作还是非安全操作，并结合自身是属于 secure world 状态还是 non-secure 状态来判定是否需要执行当前的指令操作。而 cortex 的 secure world 和 non-secure world 状态之间的切换由 monitor 来完成，最近由于 ATF（arm trusted firmware）的给出，cortex 的状态切换操作都是在 ATF 中完成。当 cortex 处于 secure world 状态时，cortex 会去执行 TEE(Trusted execute enviorment) OS 部分的代码，当 cortex 处于 non-secure world 状态时，cortex 回去执行 linux kernel 部分的代码。而 linux kernel 是无法访问 TEE 部分所有资源，只能通过特定的 TA(Trust Application) 和 CA(Client Application) 来访问 TEE 部分特定的资源。关于 TEE 和 trustzone 的更加详细资料在网上有一大堆，在次就不做过多的冗述。")]),s._v(" "),t("p",[s._v("TEE 是基于 trustzone 技术搭建的安全执行环境。当 cortex 处于 secure world 态时，cortex 执行的是 TEE OS 的代码。而当前全世界并未有一个统一的 TEE OS，各家厂商和组织都有各自的实现方式，但是所有的方案的外部接口都会遵循 GP（GlobalPlatform）标准。所有对于二级厂商来说，使用更加方便。当前具有自己 TEE 解决方案的厂商有：高通的 Qsee, Trustonic 的 tee OS，OP-TEE OS，opentee，海思，Mstar，VIA，豆荚科技等，笔者使用过上述几家厂商中的大部分，外部接口统一，只是 TA 的添加和加载时的校验有所区别。")]),s._v(" "),t("p",[s._v("由于各厂商的 TEE OS 都属于闭源的，所以关于内部的 SMC 响应机制，TEE OS 内个进程的调度机制，TZPC 的相关配置等都无法详细了解。")]),s._v(" "),t("p",[s._v("本文以 OP-TEE 为例。在 QEMU 上搭建 OP-TEE 的运行环境，后续章节将会介绍添加自有 TA 和 CA、工程编译、启动机制等其他更加详细的内容。")]),s._v(" "),t("h2",{attrs:{id:"hello-world-示例程序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hello-world-示例程序"}},[s._v("#")]),s._v(" hello-world 示例程序")]),s._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"title"},[s._v("注意事项")]),t("p",[s._v("演示环境为 VMware Fusion Player 12.1.0 下的 ubuntu 20.04。")])]),t("h3",{attrs:{id:"_0-可选-替换-apt-源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_0-可选-替换-apt-源"}},[s._v("#")]),s._v(" 0. [可选] 替换 apt 源")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Ubuntu 图形安装器会根据用户设定的时区推断 locale，这导致默认的源地址通常不是 http://archive.ubuntu.com/， 而是 http://<country-code>.archive.ubuntu.com/ubuntu/ ，如 http://cn.archive.ubuntu.com/ubuntu/， 此时只需将上面的命令进行相应的替换即可")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/us.archive.ubuntu.com/mirrors.ustc.edu.cn/g'")]),s._v(" /etc/apt/sources.list\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/security.ubuntu.com/mirrors.ustc.edu.cn/g'")]),s._v(" /etc/apt/sources.list\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_1-安装依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装依赖"}},[s._v("#")]),s._v(" 1. 安装依赖")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @see https://optee.readthedocs.io/en/latest/building/prerequisites.html#prerequisites")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" dpkg --add-architecture i386\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#\tubuntu 20.04 has dropped python-serial")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y android-tools-adb android-tools-fastboot autoconf \t\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\tautomake "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bc")]),s._v(" bison build-essential ccache cscope "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" device-tree-compiler "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v(" flex ftp-upload gdisk iasl libattr1-dev libcap-dev \t\t\t\t\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\tlibfdt-dev libftdi-dev libglib2.0-dev libhidapi-dev libncurses5-dev \t\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\tlibpixman-1-dev libssl-dev libtool "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mtools")]),s._v(" netcat python-crypto python3-crypto python-pyelftools \t\t\t\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\tpython3-pycryptodome python3-pyelftools python3-serial \t\t\t\t\t\t\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" uuid-dev xdg-utils xterm xz-utils zlib1g-dev\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" cmake\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -sf /usr/bin/python3 /usr/bin/python\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("h3",{attrs:{id:"_2-下载并配置-git-repo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-下载并配置-git-repo"}},[s._v("#")]),s._v(" 2. 下载并配置 git-repo")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -e\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone -b v2.12.2 http://mirrors.ustc.edu.cn/aosp/git-repo.git\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" u+x git-repo/repo\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" git-repo/repo /usr/bin/\n\nrepo --version\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"export REPO_URL='https://gerrit-googlesource.lug.ustc.edu.cn/git-repo'\"")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" ~/.bashrc\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"export REPO_REV=v2.12.2"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" ~/.bashrc\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" ~/.bashrc\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf git-repo\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("h3",{attrs:{id:"_3-下载-optee-代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-下载-optee-代码"}},[s._v("#")]),s._v(" 3. 下载 optee 代码")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" ~/.bashrc\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("workdir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PWD")]),s._v("/optee\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$workdir")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$workdir")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$workdir")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" config --global url."),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://hub.fastgit.org"')]),s._v(".insteadOf https://github.com\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" config --global user.email "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"optee@optee.com"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" config --global user.name "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"optee"')]),s._v("\n\nrepo init -b "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.12")]),s._v(".0 -u https://github.com/OP-TEE/manifest.git -m qemu_v8.xml\n\nrepo "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("blockquote",[t("p",[s._v("后续步骤用 "),t("code",[s._v("opteeDir")]),s._v(" 变量表示拉取到的 optee 代码。")])]),s._v(" "),t("h3",{attrs:{id:"_4-替换部分软件源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-替换部分软件源"}},[s._v("#")]),s._v(" 4. 替换部分软件源")]),s._v(" "),t("blockquote",[t("p",[s._v("主要是为了解决翻墙问题。")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("buildDir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$opteeDir")]),s._v("/build\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("binrel")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://developer.arm.com/-/media/Files/downloads/gnu-a/9.2-2019.12/binrel\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fastgit")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("hub.fastgit.org\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("github")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://hub.fastgit.org/sammyne/gcc-arm/releases/download/9.2-2019.12\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s!'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$binrel")]),s._v("!"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$github")]),s._v('!g"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$buildDir")]),s._v("/toolchain.mk\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s!https://github.com!https://'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$fastgit")]),s._v('!g"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$buildDir")]),s._v("/get_clang.sh\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("workdir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$opteeDir")]),s._v("/buildroot\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$workdir")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ustc")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://mirrors.ustc.edu.cn"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cpan")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://cpan.metacpan.org"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gnu")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://ftpmirror.gnu.org"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("kernel")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://cdn.kernel.org/pub"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s|'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$cpan")]),s._v("|"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ustc")]),s._v('/CPAN|g"')]),s._v(" Config.in\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s|'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$gnu")]),s._v("|"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ustc")]),s._v('/gnu|g"')]),s._v(" Config.in\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s|'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$kernel")]),s._v("|"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ustc")]),s._v('/kernel.org|g"')]),s._v(" Config.in\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$workdir")]),s._v("/package\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("savannah")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://download.savannah.gnu.org"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("savannah2")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://download-mirror.savannah.gnu.org"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("savannahNew")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://www.mirrorservice.org/sites/download.savannah.gnu.org"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("savannahPkgs")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" savannah -rl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" .mk"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s|'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$savannah")]),s._v("|"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$savannahNew")]),s._v('|g"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$savannahPkgs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s|'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$savannah2")]),s._v("|"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$savannahNew")]),s._v('|g"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$savannahPkgs")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fastgit")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hub.fastgit.org"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("depRepo")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$fastgit")]),s._v('/sammyne/optee-dep/releases/download/3.12.0"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s|^LIBOPENSSL_SITE =.*|LIBOPENSSL_SITE = '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$depRepo")]),s._v('|g"')]),s._v(" libopenssl/libopenssl.mk\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s|^PYTHON3_SITE =.*|PYTHON3_SITE = '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$depRepo")]),s._v('|g"')]),s._v(" python3/python3.mk\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s|^STRACE_SITE =.*|STRACE_SITE = https://'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$fastgit")]),s._v('/strace/strace/releases/download/v5.7|g"')]),s._v(" strace/strace.mk\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br")])]),t("h3",{attrs:{id:"_5-配置工具链"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-配置工具链"}},[s._v("#")]),s._v(" 5. 配置工具链")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @see https://optee.readthedocs.io/en/latest/building/toolchains.html")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("buildDir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$opteeDir")]),s._v("/build\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$buildDir")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/toolchains\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3.12.0 miss SHELL setting, which trigger bad substitution error")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -z "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^SHELL'")]),s._v(" toolchain.mk"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1i\\SHELL = /bin/bash'")]),s._v(" toolchain.mk\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" -f toolchain.mk\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("h3",{attrs:{id:"_6-编译"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-编译"}},[s._v("#")]),s._v(" 6. 编译")]),s._v(" "),t("blockquote",[t("p",[s._v("编译过程需要回答问题，添加 "),t("code",[s._v("DEBIAN_FRONTEND=noninteractive")]),s._v(" 环境变量可能可以减去交互的麻烦。")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$opteeDir")]),s._v("/build\n\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"_7-启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-启动"}},[s._v("#")]),s._v(" 7. 启动")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$opteeDir")]),s._v("/build\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" run\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("上述命令会启动一个 QEMU 控制台，这个控制台还会开辟两个 UART 控制台，分别连接安全世界和常规世界。")]),s._v(" "),t("p",[s._v("QEMU 控制台的最后几行输出")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("make"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Entering directory "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/home/sammyne/Workspace/optee/build'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -sf /home/sammyne/Workspace/optee/build/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/out-br/images/rootfs.cpio.gz /home/sammyne/Workspace/optee/build/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/out/bin/\n\n* QEMU is now waiting to start the execution\n* Start execution with either a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'c'")]),s._v(" followed by "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("enter"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the QEMU console or\n* attach a debugger and "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("continue")]),s._v(" from there.\n*\n* To run OP-TEE tests, use the xtest "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Normal World'")]),s._v(" terminal\n* Enter "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xtest -h'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" help.\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Option “-x” is deprecated and might be removed in a later version of gnome-terminal.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use “-- ” to terminate the options and put the command line to execute after it.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Option “-x” is deprecated and might be removed in a later version of gnome-terminal.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use “-- ” to terminate the options and put the command line to execute after it.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/sammyne/Workspace/optee/build/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/out/bin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" /home/sammyne/Workspace/optee/build/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/qemu/aarch64-softmmu/qemu-system-aarch64 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t-nographic "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t-serial tcp:localhost:54320 -serial tcp:localhost:54321 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t-smp "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t-s -S -machine virt,secure"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on -cpu cortex-a57 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t-d unimp -semihosting-config enable,target"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("native "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t-m "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1057")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t-bios bl1.bin "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t-initrd rootfs.cpio.gz "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t-kernel Image -no-acpi "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t-append "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'console=ttyAMA0,38400 keep_bootcon root=/dev/vda2'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t-object rng-random,filename"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/urandom,id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("rng0 -device virtio-rng-pci,rng"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("rng0,max-bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(",period"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" -netdev user,id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("vmnic -device virtio-net-device,netdev"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("vmnic\nQEMU "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.1")]),s._v(".0 monitor - "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'help'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" information\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("qemu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("p",[s._v("安全世界的控制台输出")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("listening on port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("54321")]),s._v("\nsoc_term: accepted fd "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\nsoc_term: "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" fd EOF\nsoc_term: accepted fd "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("常规世界的控制台输出")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("listening on port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("54320")]),s._v("\nsoc_term: accepted fd "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\nsoc_term: "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" fd EOF\nsoc_term: accepted fd "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("然后，QEMU 控制会等待用户输入，敲入 "),t("code",[s._v("c")]),s._v(" 并回车即可继续后续步骤。此时")]),s._v(" "),t("ul",[t("li",[s._v("安全世界的控制台最后的部分输出如下")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ...")]),s._v("\nI/TC: Primary CPU switching to normal world boot\nI/TC: Secondary CPU "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" initializing\nD/TC:1   select_vector:1126 SMCCC_ARCH_WORKAROUND_1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x80008000"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" available\nD/TC:1   select_vector:1128 SMC Workaround "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" CVE-2017-5715 used\nI/TC: Secondary CPU "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" switching to normal world boot\nD/TC:0   tee_entry_exchange_capabilities:102 Dynamic shared memory is enabled\nD/TC:0 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" core_mmu_entry_to_finer_grained:750 xlat tables used "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" / "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\nD/TC:? "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" tee_ta_init_pseudo_ta_session:299 Lookup pseudo TA 7011a688-ddde-4053-a5a9-7b3c4ddf13b8\nD/TC:? "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" tee_ta_init_pseudo_ta_session:312 Open device.pta\nD/TC:? "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" tee_ta_init_pseudo_ta_session:329 device.pta "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 7011a688-ddde-4053-a5a9-7b3c4ddf13b8\nD/TC:? "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" tee_ta_close_session:514 csess 0xe43e99f0 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nD/TC:? "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" tee_ta_close_session:533 Destroy session\nD/TC:? "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" tee_ta_init_session_with_context:609 Re-open TA 7011a688-ddde-4053-a5a9-7b3c4ddf13b8\nD/TC:? "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" tee_ta_close_session:514 csess 0xe43e9840 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nD/TC:? "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" tee_ta_close_session:533 Destroy session\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("ul",[t("li",[s._v("常规世界的控制台最后"),t("strong",[s._v("部分")]),s._v("输出")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.285240")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" optee: revision "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("3d47a131"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.289375")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" optee: dynamic shared memory is enabled\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.311266")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" optee: initialized driver\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.320481")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" NET: Registered protocol family "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.325807")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 9pnet: Installing 9P2000 support\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.329443")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Key "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" dns_resolver registered\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.335122")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" registered taskstats version "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.336807")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Loading compiled-in X.509 certificates\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.407603")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" input: gpio-keys as /devices/platform/gpio-keys/input/input0\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.415790")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ALSA device list:\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.417193")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("   No soundcards found.\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.427490")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" uart-pl011 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000000")]),s._v(".pl011: no DMA platform data\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.535391")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Freeing unused kernel memory: 5760K\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.538201")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Run /init as init process\nStarting syslogd: OK\nStarting klogd: OK\nRunning sysctl: OK\nSaving random seed: OK\nSet permissions on /dev/tee*: OK\nSet permissions on /dev/ion: OK\nCreate/set permissions on /data/tee: OK\nStarting tee-supplicant: OK\nStarting network: OK\nStarting network "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("udhcpc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": OK\n\nWelcome to Buildroot, "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" root or "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" to login\nbuildroot login:\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("p",[s._v("可见常规世界在等待登录。")]),s._v(" "),t("h3",{attrs:{id:"_8-运行示例程序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-运行示例程序"}},[s._v("#")]),s._v(" 8. 运行示例程序")]),s._v(" "),t("p",[s._v("在常规世界的控制台依次执行以下步骤")]),s._v(" "),t("ol",[t("li",[s._v("以 root 账户登录常规世界")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Welcome to Buildroot, "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" root or "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" to login\nbuildroot login: root\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("运行 "),t("code",[s._v("optee_example_hello_world")]),s._v(" 程序，可得预期输出如下")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /usr/bin/optee_example_hello_world ")]),s._v("\nInvoking TA to increment "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("\nTA incremented value to "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"_9-关闭-qemu"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-关闭-qemu"}},[s._v("#")]),s._v(" 9. 关闭 QEMU")]),s._v(" "),t("p",[s._v("在 QEMU 控制台输出 "),t("code",[s._v("q")]),s._v("，然后回车即可退出。")]),s._v(" "),t("h2",{attrs:{id:"参考文献"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考文献"}},[s._v("#")]),s._v(" 参考文献")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://blog.csdn.net/shuaifengyun/article/details/71499619?spm=1001.2014.3001.5501",target:"_blank",rel:"noopener noreferrer"}},[s._v("使用Qemu运行OP-TEE"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://optee.readthedocs.io/en/latest/building/gits/build.html#get-and-build-the-solution",target:"_blank",rel:"noopener noreferrer"}},[s._v("Get and build the solution"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);