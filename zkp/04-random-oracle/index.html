<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>[ZKP] 04. 随机挑战 | sammyne</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Just playing around :)">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.49bc6dee.css" as="style"><link rel="preload" href="/assets/js/app.b0783623.js" as="script"><link rel="preload" href="/assets/js/3.3f52b992.js" as="script"><link rel="preload" href="/assets/js/1.86295094.js" as="script"><link rel="preload" href="/assets/js/13.42ab1ca0.js" as="script"><link rel="prefetch" href="/assets/js/10.1038f603.js"><link rel="prefetch" href="/assets/js/11.96eec3c9.js"><link rel="prefetch" href="/assets/js/12.83e92912.js"><link rel="prefetch" href="/assets/js/14.051d7969.js"><link rel="prefetch" href="/assets/js/15.a2a144a5.js"><link rel="prefetch" href="/assets/js/16.2316213b.js"><link rel="prefetch" href="/assets/js/17.8a6b7ba1.js"><link rel="prefetch" href="/assets/js/18.2f024290.js"><link rel="prefetch" href="/assets/js/19.bb61da94.js"><link rel="prefetch" href="/assets/js/20.3baee549.js"><link rel="prefetch" href="/assets/js/21.bd9d06e6.js"><link rel="prefetch" href="/assets/js/22.e875d593.js"><link rel="prefetch" href="/assets/js/23.82a9f40d.js"><link rel="prefetch" href="/assets/js/24.8d2fd429.js"><link rel="prefetch" href="/assets/js/25.0e53cc79.js"><link rel="prefetch" href="/assets/js/26.67192360.js"><link rel="prefetch" href="/assets/js/27.ed0fc0f9.js"><link rel="prefetch" href="/assets/js/28.926ee6a4.js"><link rel="prefetch" href="/assets/js/29.80faf7b7.js"><link rel="prefetch" href="/assets/js/30.213d982d.js"><link rel="prefetch" href="/assets/js/31.765f0666.js"><link rel="prefetch" href="/assets/js/32.9d587569.js"><link rel="prefetch" href="/assets/js/33.2d74623b.js"><link rel="prefetch" href="/assets/js/34.475e7cdc.js"><link rel="prefetch" href="/assets/js/35.908be713.js"><link rel="prefetch" href="/assets/js/36.6fbc52ca.js"><link rel="prefetch" href="/assets/js/37.f9bf727c.js"><link rel="prefetch" href="/assets/js/38.fef41532.js"><link rel="prefetch" href="/assets/js/39.4421cdc1.js"><link rel="prefetch" href="/assets/js/4.9829be90.js"><link rel="prefetch" href="/assets/js/40.188ea825.js"><link rel="prefetch" href="/assets/js/41.edbf984e.js"><link rel="prefetch" href="/assets/js/42.57689383.js"><link rel="prefetch" href="/assets/js/43.ce0e01a7.js"><link rel="prefetch" href="/assets/js/44.473b138f.js"><link rel="prefetch" href="/assets/js/45.c6bbec4e.js"><link rel="prefetch" href="/assets/js/46.23e5360f.js"><link rel="prefetch" href="/assets/js/47.6ab91381.js"><link rel="prefetch" href="/assets/js/48.f58019a7.js"><link rel="prefetch" href="/assets/js/49.d9d77fae.js"><link rel="prefetch" href="/assets/js/5.92ba615f.js"><link rel="prefetch" href="/assets/js/50.cb88fead.js"><link rel="prefetch" href="/assets/js/51.5f5eee7e.js"><link rel="prefetch" href="/assets/js/52.ae4e6334.js"><link rel="prefetch" href="/assets/js/53.17db3a12.js"><link rel="prefetch" href="/assets/js/54.a44acc29.js"><link rel="prefetch" href="/assets/js/55.7609969e.js"><link rel="prefetch" href="/assets/js/56.a09370cd.js"><link rel="prefetch" href="/assets/js/57.91ad3180.js"><link rel="prefetch" href="/assets/js/58.3f9fefc9.js"><link rel="prefetch" href="/assets/js/59.bd3086a3.js"><link rel="prefetch" href="/assets/js/6.905f5193.js"><link rel="prefetch" href="/assets/js/60.c546fe10.js"><link rel="prefetch" href="/assets/js/61.9ccc2ba1.js"><link rel="prefetch" href="/assets/js/62.f1b003ea.js"><link rel="prefetch" href="/assets/js/63.de9866b5.js"><link rel="prefetch" href="/assets/js/64.72747782.js"><link rel="prefetch" href="/assets/js/65.88ebceab.js"><link rel="prefetch" href="/assets/js/66.1f3bf41a.js"><link rel="prefetch" href="/assets/js/67.fbd16fac.js"><link rel="prefetch" href="/assets/js/68.26515c6c.js"><link rel="prefetch" href="/assets/js/69.09a64b94.js"><link rel="prefetch" href="/assets/js/7.7171cbe2.js"><link rel="prefetch" href="/assets/js/70.7cba800b.js"><link rel="prefetch" href="/assets/js/71.e0084a77.js"><link rel="prefetch" href="/assets/js/72.e726cffb.js"><link rel="prefetch" href="/assets/js/73.bc1fee0e.js"><link rel="prefetch" href="/assets/js/74.ef6e88e5.js"><link rel="prefetch" href="/assets/js/75.25cfbdb6.js"><link rel="prefetch" href="/assets/js/76.5a03f68d.js"><link rel="prefetch" href="/assets/js/77.de3edd02.js"><link rel="prefetch" href="/assets/js/78.1ede0de5.js"><link rel="prefetch" href="/assets/js/79.1e9de511.js"><link rel="prefetch" href="/assets/js/8.238305b1.js"><link rel="prefetch" href="/assets/js/80.ff38b9a8.js"><link rel="prefetch" href="/assets/js/81.1bd646a8.js"><link rel="prefetch" href="/assets/js/82.1032f05f.js"><link rel="prefetch" href="/assets/js/83.6dd528a0.js"><link rel="prefetch" href="/assets/js/84.2754c104.js"><link rel="prefetch" href="/assets/js/85.b5a8853a.js"><link rel="prefetch" href="/assets/js/86.497b7fb0.js"><link rel="prefetch" href="/assets/js/87.5bc8eeeb.js"><link rel="prefetch" href="/assets/js/88.7db14baa.js"><link rel="prefetch" href="/assets/js/89.702460a9.js"><link rel="prefetch" href="/assets/js/9.4984f96a.js"><link rel="prefetch" href="/assets/js/90.13d6ecc9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.49bc6dee.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>sammyne</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>Just playing around :)</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>sammyne</span>
            
          <span data-v-4e82dffc>2020 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="sammyne" class="logo"> <span class="site-name">sammyne</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/os/" class="nav-link"><i class="undefined"></i>
  os
</a></li><li class="dropdown-item"><!----> <a href="/categories/dev/" class="nav-link"><i class="undefined"></i>
  dev
</a></li><li class="dropdown-item"><!----> <a href="/categories/crypto/" class="nav-link"><i class="undefined"></i>
  crypto
</a></li><li class="dropdown-item"><!----> <a href="/categories/programming/" class="nav-link"><i class="undefined"></i>
  programming
</a></li><li class="dropdown-item"><!----> <a href="/categories/tee/" class="nav-link"><i class="undefined"></i>
  tee
</a></li><li class="dropdown-item"><!----> <a href="/categories/engineering/" class="nav-link"><i class="undefined"></i>
  engineering
</a></li><li class="dropdown-item"><!----> <a href="/categories/tool/" class="nav-link"><i class="undefined"></i>
  tool
</a></li><li class="dropdown-item"><!----> <a href="/categories/language/" class="nav-link"><i class="undefined"></i>
  language
</a></li><li class="dropdown-item"><!----> <a href="/categories/decentralization/" class="nav-link"><i class="undefined"></i>
  decentralization
</a></li><li class="dropdown-item"><!----> <a href="/categories/architecture/" class="nav-link"><i class="undefined"></i>
  architecture
</a></li><li class="dropdown-item"><!----> <a href="/categories/network/" class="nav-link"><i class="undefined"></i>
  network
</a></li><li class="dropdown-item"><!----> <a href="/categories/software engineering/" class="nav-link"><i class="undefined"></i>
  software engineering
</a></li><li class="dropdown-item"><!----> <a href="/categories/notes/" class="nav-link"><i class="undefined"></i>
  notes
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="https://github.com/sammyne" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    sammyne
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>80</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>43</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/os/" class="nav-link"><i class="undefined"></i>
  os
</a></li><li class="dropdown-item"><!----> <a href="/categories/dev/" class="nav-link"><i class="undefined"></i>
  dev
</a></li><li class="dropdown-item"><!----> <a href="/categories/crypto/" class="nav-link"><i class="undefined"></i>
  crypto
</a></li><li class="dropdown-item"><!----> <a href="/categories/programming/" class="nav-link"><i class="undefined"></i>
  programming
</a></li><li class="dropdown-item"><!----> <a href="/categories/tee/" class="nav-link"><i class="undefined"></i>
  tee
</a></li><li class="dropdown-item"><!----> <a href="/categories/engineering/" class="nav-link"><i class="undefined"></i>
  engineering
</a></li><li class="dropdown-item"><!----> <a href="/categories/tool/" class="nav-link"><i class="undefined"></i>
  tool
</a></li><li class="dropdown-item"><!----> <a href="/categories/language/" class="nav-link"><i class="undefined"></i>
  language
</a></li><li class="dropdown-item"><!----> <a href="/categories/decentralization/" class="nav-link"><i class="undefined"></i>
  decentralization
</a></li><li class="dropdown-item"><!----> <a href="/categories/architecture/" class="nav-link"><i class="undefined"></i>
  architecture
</a></li><li class="dropdown-item"><!----> <a href="/categories/network/" class="nav-link"><i class="undefined"></i>
  network
</a></li><li class="dropdown-item"><!----> <a href="/categories/software engineering/" class="nav-link"><i class="undefined"></i>
  software engineering
</a></li><li class="dropdown-item"><!----> <a href="/categories/notes/" class="nav-link"><i class="undefined"></i>
  notes
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="https://github.com/sammyne" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>[ZKP] 04. 随机挑战</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>sammyne</span>
            
          <span data-v-4e82dffc>2020 - </span>
          2021
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">[ZKP] 04. 随机挑战</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>sammyne</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>2/14/2021</span></i> <i class="iconfont reco-eye" data-v-1ff7123e><span id="/zkp/04-random-oracle/" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-1ff7123e><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>ZKP</span><span class="tag-item" data-v-1ff7123e>schnorr</span></i></div></div> <div class="theme-reco-content content__default"><blockquote><p>原文链接：<a href="https://github.com/sec-bit/learning-zkp/blob/master/zkp-intro/4/zkp-rom.md" target="_blank" rel="noopener noreferrer">随机「挑战」<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p><a href="/tag/ZKP/">本系列文章</a> 以非专业的视角介绍零知识相关知识。</p></blockquote> <blockquote><p>&quot;Challenges are at times an indication of Lord's trust in you.&quot; 挑战，有时是上天信任你的一种表现。―- D. Todd Christofferson</p></blockquote> <h2 id="交互与挑战"><a href="#交互与挑战" class="header-anchor">#</a> 交互与挑战</h2> <p>之前介绍的零知识证明系统都是<strong>交互式</strong>的，需要验证者 Bob 提供一个或若干个<strong>随机数</strong>来挑战。比如<strong>地图三染色问题</strong>（参见 <a href="/2021/02/14/zkp-02-simulation/">理解模拟</a>）中，验证者 Bob 需要<strong>不断地</strong>随机挑选一条边来挑战 Alice 的答案，直到 Bob 满意为止，而 Alice 的作弊概率会<strong>指数级</strong>地衰减。而让 Bob 相信证明的<strong>基础</strong>取决于 Bob 所挑选的随机数是不是足够随机。如果 Alice 能够提前预测到 Bob 的随机数，灾难就会发生，现实世界就会退化成<strong>理想世界</strong>，而 Alice 就可以立即升级成<strong>模拟器</strong>，利用超能力来愚弄 Bob。</p> <p><a href="/2021/02/14/zkp-03-pok/">寻找知识</a> 分析了 Schnorr 协议：协议中，虽然验证者 Bob 只需要挑选一个随机数 <code>c</code> 来挑战 Alice ，让她计算一个值 <code>z</code>，但 Bob 绝对不能让 Alice 有能力来预测到 <code>c</code> 的任何知识，否则 Alice 也会变身成模拟器。</p> <p>随机数的重要性不言而喻：</p> <div class="custom-block tip"><p class="title"></p><p>通过随机数挑战是交互式零知识证明的<strong>信任根基</strong>。</p></div><p>但<strong>交互过程</strong>会限制应用场景。如果能将交互式零知识证明变成<strong>非交互</strong>？这会非常非常激动人心。所谓的非交互可以看成只有<strong>一轮</strong>的证明过程，即 Alice 直接发一个证明给 Bob 进行验证。</p> <p>非交互式零知识证明，英文是 <code>Non-Interactive Zero Knowledge</code>，简称 <strong>NIZK</strong>。它意味着：整个证明被编码为一个<strong>字符串</strong>，可以写到一张纸上，通过邮件、聊天工具等各种方式随意发送给任何验证者，甚至可以放在 Github 上随时供大家下载验证。</p> <p>在区块链世界，<strong>NIZK</strong>可以作为共识协议的一部分。因为一个交易<strong>需要多个矿工进行校验</strong>。设想下，如果交易的发送者和每个矿工都要交互一下，让矿工进行挑战，那么共识过程将奇慢无比。而非交互式零知识证明则<strong>可以直接广播给所有矿工节点</strong>，让他们自行验证。</p> <p>可能有朋友会问：只让一个矿工挑战不就够了吗？把矿工和交易发送者的交互脚本编码成证明，然后广播给其他矿工，然后其他矿工就直接相信这个挑战过程是可信的，不也可以吗？但是，很显然这里需要相信第一个交互矿工作为可信第三方。第三方似乎不是一个好主意......</p> <p>而非交互式零知识证明（往后简称<strong>NIZK</strong>）似乎就很理想了，没有第三方赚差价。</p> <h2 id="非交互带来的困惑"><a href="#非交互带来的困惑" class="header-anchor">#</a> 非交互带来的困惑</h2> <p>非交互式零知识证明 NIZK 如果存在，那么它要比交互式证明强大得多。</p> <ul><li>交互式证明只能取信于一个验证者；而 NIZK 可以取信于多个验证者，以至所有人。</li> <li>交互式证明只能在交互的那个时刻有效；而 NIZK 将始终有效。</li></ul> <blockquote><p>NIZK 不仅可以跨越空间，还能跨越时间</p></blockquote> <p>听上去很美，不是吗？然而 😦</p> <p>重复下上节的一个结论：</p> <div class="custom-block tip"><p class="title"></p><p>通过随机数挑战是交互式零知识证明的<strong>信任根基</strong>。</p></div><p>可是如果 NIZK 失去了挑战过程，有什么后果？</p> <p>回顾<strong>零知识</strong>性质的证明（参考 <a href="/2021/02/14/zkp-02-simulation/">理解模拟</a>）：证明过程需要构造一个模拟器（算法）和验证者（Bob）在理想世界进行交互，而验证者 Bob 没有能力区分出来对方是否是真的 Alice 还是一个模拟器。</p> <p>如果现在考虑下 NIZK 的 <strong>非交互式</strong>：假如<strong>我</strong>向<strong>你</strong>出示一张纸，上面写着一个<strong>真</strong>证明 <code>X</code>，又假如<strong>你</strong>看过这张纸之后确实相信我了；又因为协议是<strong>零知识</strong>，那么如果把<strong>我</strong>换成一个模拟器，模拟器也能<strong>伪造</strong>一个假证明 <code>Y</code>，能够也让<strong>你</strong>相信。</p> <p>好了，问题来了：</p> <ul><li>你如何区分 <code>X</code> 和 <code>Y</code> ，孰真孰假？当然你无法区分，因为协议是零知识的，你必须不能区分</li> <li>我同样可以把 <code>Y</code> 出示给你看，那岂不是<strong>我</strong>就可以欺骗你了吗？</li></ul> <p>是不是不和谐了？请大家在此处思考两分钟。</p> <p>(两分钟后 ......)</p> <p>因为 NIZK 没有了交互，也就没了挑战过程，所有的证明过程都由 Alice 计算书写。理论上 Alice 确实是想写什么就写什么，没人拦得住。比如 Alice 就写<strong>理想世界</strong>的假证明 <code>Y</code>。</p> <p>想必深刻理解模拟器的朋友，在这里会发现一个关键点：模拟器必须<strong>只能</strong>在<strong>理想世界</strong>构造<code>Y</code>，也就是说，<code>Y</code> 这么邪恶的东西只能存在于<strong>理想世界</strong>，不能到<strong>现实世界</strong>祸害人间。</p> <p>继续思考 ......</p> <p>还有一个更深层次的问题，请大家回忆下<strong>地图三染色问题</strong>。之所以模拟器不能在<strong>现实世界</strong>为非作歹，核心原因是他在理想世界有<strong>时间倒流</strong>的超能力，而在<strong>现实世界</strong>不存在这种黑魔法。现实世界的<strong>不存在性</strong>是关键。</p> <p>而且 NIZK <strong>没有交互</strong> 导致了一个严重的后果--模拟器没有办法使用<strong>时间倒流</strong>这个超能力，当然似乎也就不能区分证明者在两个世界的行为。</p> <p>换句话说，如果我们面对任何一个 NIZK 系统，似乎<strong>模拟器</strong>就很难高高在上了，它好像只能飘落人间，成为一个普普通通的凡人。如果按此推论，假设模拟器不再具备超能力，那就意味着 Alice 和模拟器没有区别，Alice 也可以成为一个模拟器，再继续推论，Alice 就可以在<strong>现实世界</strong>任意欺骗 Bob，那么这个失去了可靠性的证明系统就不再有价值。结论：任何的 NIZK 都不可靠。</p> <p>这一定是哪里出了问题 ......</p> <p>上面分析过程提到了交互挑战的缺失。确实如果 Bob 不参与 Alice 产生证明的过程，证明所包含的每一个比特都由 Alice 提供，似乎<strong>证明</strong>本身不存在任何让 Bob 信任的<strong>根基</strong>。这个从<strong>直觉</strong>上似乎说不通。</p> <p>那是不是说，没有 Bob 的参与就<strong>彻底</strong>没办法建立<strong>信任根基</strong>了呢？信任的根基还可以从哪里来呢？</p> <p>答案是<strong>第三方</strong>！</p> <p>且慢，协议交互不是只有两方吗？Alice 和 Bob，哪来第三方？</p> <p>需要用特殊的方式引入第三方，而且方法不止一种，我们先研究第一种。</p> <p>😦 不是说的好好的，咱们不引入第三方吗？</p> <h2 id="回顾-schnorr-协议"><a href="#回顾-schnorr-协议" class="header-anchor">#</a> 回顾 Schnorr 协议</h2> <p>再看一下老朋友--Schnorr 协议，它是一个三步协议：</p> <ol><li>Alice 发送一个承诺</li> <li>Bob 发送随机数挑战</li> <li>Alice 回应挑战</li></ol> <p><img src="/assets/img/schnorr.21738c7f.png" alt=""></p> <p>接下来把这个三步的 Schnorr 协议变成一步。</p> <p>看一下 Schnorr 协议的第二步，Bob 需要给出一个随机的挑战数 <code>c</code>。这里可以让 Alice 用下面这个式子来计算这个挑战数，从而达到去除协议第二步的目的。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>c = Hash(PK, R)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>其中 <code>R</code> 是 Alice 发给 Bob 的椭圆曲线点，<code>PK</code> 是公钥。大家可以好好看看这个利用哈希算法 <code>Hash</code> 计算 <code>c</code> 的式子。这个式子达到两个目的：</p> <ol><li>Alice 在产生承诺 <code>R</code> 之前，没有办法预测 <code>c</code>，即使 <code>c</code> 最终变相是 Alice 挑选的</li> <li><code>c</code> 通过哈希函数计算，会均匀分布在一个整数域内，而且可以作为一个随机数（<em>注：请大家暂且这么理解，我们在后文再深入讨论</em>）</li></ol> <div class="custom-block warning"><p class="title"></p><p>Alice 绝不能在产生 <code>R</code> 之前预测到 <code>c</code>，不然 Alice 就等于变相具有了<strong>时间倒流</strong>的超能力，能任意愚弄 Bob。</p></div><p>而一个密码学安全哈希函数是<strong>单向</strong>的，比如 SHA256、SHA3、blake2 等等。这样一来，虽然 <code>c</code> 是 Alice 计算的，但是 Alice 并没有能力通过挑选 <code>c</code> 来作弊。因为只要 Alice 一产生 <code>R</code>， <code>c</code> 就相当于固定下来了。假设 Alice 这个凡人在<strong>现实世界</strong>没有反向计算哈希原像的能力。</p> <p><img src="/assets/img/schnorr-nizk.61d3185b.png" alt="schnorr-nizk"></p> <p>上图利用哈希函数把三步 Schnorr 协议合并为一步。Alice 可以直接发送：<code>(R, c, z)</code>。又因为 Bob 拥有 <code>PK</code>，于是 Bob 可以自行计算出 <code>c</code>，于是 Alice 可以只发送 <code>(R, z)</code> 即可。</p> <p>我们把上面这个方案稍微变下形，就得到了<strong>数字签名</strong>方案。所谓的数字签名，就是<strong>我</strong>向<strong>你</strong>出示一个字符串，比如<strong>白日依山尽，黄河入海流</strong>，然后为了证明这句诗是我出示的，我需要签署某样东西。这个东西能证明我的身份和这句诗进行了关联。</p> <h2 id="从-nizk-角度看数字签名"><a href="#从-nizk-角度看数字签名" class="header-anchor">#</a> 从 NIZK 角度看数字签名</h2> <p>不严格地说，数字签名方案相当于在证明</p> <ul><li>我拥有私钥</li> <li>私钥和消息进行了关联计算</li></ul> <p>我首先要证明个人身份。这个正是 Schnorr 协议的功能--向对方证明<strong>我拥有私钥</strong>这个陈述。证明过程是零知识的：不泄露关于<strong>私钥</strong>的任何知识。</p> <p>那么如何和这句唐诗关联呢？我们修改下计算 <code>c</code> 的过程：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>m = &quot;白日依山尽，黄河入海流&quot;
c = Hash(m, R)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这里为了保证攻击者不能随意伪造签名，正是利用了离散对数难题（DLP）与哈希函数满足抗第二原象（Secondary Preimage Resistance ）这个假设。</p> <div class="custom-block warning"><p class="title"></p><p>这里严格点讲，为了保证数字签名的不可伪造性，需要证明 Schnorr 协议满足<strong>Simulation Soundness</strong>这个更强的性质。这点请参考文献 [2]。</p></div><p><img src="/assets/img/schnorr-sig.9238e422.png" alt=""></p> <p>上图就是大家所熟知的数字签名方案 -- Schnorr 签名方案 [1]。在这里还有一个优化，Alice 发给 Bob 的内容不是 <code>(R, z)</code> 而是 <code>(c, z)</code>，这是因为 <code>R</code> 可以通过 <code>c</code>, <code>z</code> 计算出来。</p> <div class="custom-block tip"><p class="title"></p><p>为什么说这是一个<strong>优化</strong>呢？目前针对椭圆曲线的攻击方法有 Shanks 算法、Lambda 算法 还有 Pollard's rho 算法， 请大家记住他们的算法复杂度大约都是 $O(\sqrt{n})$[3]，其中 <code>n</code> 是有限域大小的位数。假设我们采用了非常接近 <code>2^256</code> 的有限域，也就是说 <code>z</code> 是 256 比特，那么椭圆曲线群的大小也差不多要接近 256比特，这样一来，把 <code>2^256</code> 开平方根后就是 <code>2^128</code>，所以说 256bit 椭圆曲线群的安全性只有 128 比特。那么，挑战数  <code>c</code> 也只需要 128 比特就足够了。这样 Alice 发送 <code>c</code> 要比发送 <code>R</code> 要更节省空间，而后者至少需要 256 比特。<code>c</code> 和 <code>z</code>两个数值加起来总共 384 比特。相比现在流行的 ECDSA 签名方案来说，可以节省<code>1/4</code> 的宝贵空间。现在比特币开发团队已经准备将 ECDSA 签名方案改为一种类 Schnorr 协议的签名方案--muSig [4]，可以更灵活地支持多签和聚合。*</p></div><p>采用哈希函数的方法来把一个交互式的证明系统变成非交互式的方法被称为 <strong>Fiat-Shamir 变换</strong> [5]，它由密码学老前辈 Amos Fiat 和 Adi Shamir 两人在 1986 年提出。</p> <h2 id="重建信任-随机预言精灵"><a href="#重建信任-随机预言精灵" class="header-anchor">#</a> 重建信任 -- 随机预言精灵</h2> <p>前文提到：失去了挑战，似乎失去了证明的<strong>信任根基</strong>。而在 Schnorr 签名方案中，哈希函数担负起了<strong>挑战者</strong>的角色，这个角色有一个非常学术的名字：<strong>随机预言机</strong>（Random Oracle）[6]。</p> <p>可是这里为何用哈希？实际上当 Alice 要产生公共随机数时，需要一个叫做<strong>随机预言机</strong>的玩意儿，这是什么？</p> <p>开脑洞时间到！</p> <p>设想这样的一个<strong>现实世界</strong>：天上有一位<strong>精灵</strong>，他手持一个双栏表格，左边一栏为字符串，右边一栏为数字。任何人，包括你我，包括 Alice 和 Bob，都可以发字符串给<strong>精灵</strong>。</p> <p><img src="/assets/img/ro.d6bd7fb8.png" alt=""></p> <p>精灵在拿到字符串之后，会查表的左边栏，看看表格里有没有这个字符串，下面分两种情况：</p> <ul><li>情况一：如果左边栏找不到字符串，那么精灵会产生一个<strong>真随机数</strong>，然后把字符串与随机数写入到表格中，然后把随机数返回地面上的凡人。</li> <li>情况二：如果左边栏有这个字符串记录，那么精灵会将右边栏里面的数字直接返回给地面。</li></ul> <p>大家会发现这个精灵的行为其实很像一个随机数发生器，但是又很不一样。不一样的地方在于当我们发送相同的字符串时，他会返回相同的数。这个精灵就是传说中的<strong>随机预言机</strong>。</p> <p>而在合并 Schnorr 协议过程中，其实我们需要的是一个这样的随机预言精灵，而不是一个哈希函数。两者有什么不同的地方？区别就是：</p> <ul><li>随机预言机每次对于新字符串返回的是一个具有一致性分布的<strong>真</strong>随机数</li> <li>哈希函数计算的结果并不是一个真正具有一致性分布的随机数</li></ul> <p>那么为什么前面用的是哈希函数呢？这是因为在现实世界中，<strong>真正的随机预言机不存在！<strong>为什么呢？事实上，哈希函数不可能产生真的随机数，因为哈希函数是一个</strong>确定性</strong>算法，除了参数以外，再没有其它随机量被引入。</p> <p>而一个具有密码学安全强度的哈希函数<strong>似乎</strong>可以充当一个<strong>伪</strong>随机预言机。那么合并后的安全协议需要额外增加一个很强的安全假设，这就是：</p> <div class="custom-block tip"><p class="title"></p><p>一个密码学安全的哈希函数可以近似地模拟传说中的<strong>随机预言机</strong></p></div><p>因为这个假设无法被证明，所以我们只能信任这个假设，或者说当做一个公理来用。插一句，哈希函数的广义抗碰撞性质决定了它的输出可以模拟随机数，同时在很多情况下（并非所有），对哈希函数实施攻击难度很高，于是许多的密码学家都在大胆使用。</p> <p>不使用这个假设的安全模型叫做<strong>标准模型</strong>，而使用这个假设的安全模型当然不能叫<strong>非标准模型</strong>，它有个好听的专有名词，叫做<strong>随机预言模型</strong>。</p> <p>世界上有两种不同类型的人，喜欢甜豆花的，不喜欢甜豆花的。同样，世界上的密码学家分为两种，喜欢随机预言模型的，和不喜欢随机预言模型的 [6]。</p> <h2 id="构造根基-被绑架的精灵"><a href="#构造根基-被绑架的精灵" class="header-anchor">#</a> 构造根基 -- 被绑架的精灵</h2> <p>Schnorr 协议经过 Fiat-Shamir 变换之后，就具有 NIZK 性质。这不同于我们证明过的 SHVZK：SHVZK 要求验证者诚实，而 NIZK 则不再对验证者有任何不现实的要求。因为验证者不参与交互，所谓要求诚实的验证者这个问题就不复存在。</p> <div class="custom-block warning"><p class="title"></p><p>如果验证者 Bob 不诚实会怎样？那么 Bob 有可能抽取出 Alice 的知识。但是对于三步 Schnorr 协议而言，它是否满足<strong>零知识</strong>，目前还处于未知状态。 <a href="/2021/02/14/zkp-03-pok/">寻找知识</a> 只证明它满足一个比较弱的性质：SHVZK。</p></div><p>但是 Schnorr 协议摇身一变成非交互零知识证明系统之后，就真正的<strong>零知识</strong>了。</p> <p>问题又来了：论断听起来似乎有道理，请问能证明吗？</p> <p>时间到了，“翠花，上模拟器”</p> <p>怎么用模拟器大法来构造一个<strong>理想世界</strong>呢？大家可以想一下，我们之前使用过<strong>时间倒流</strong>，还有使用修改<strong>随机数传送带</strong>的超能力来让<strong>模拟器</strong>来作弊。可是没有交互了，这就意味着：<strong>时间倒流</strong>超能力不能用；Bob 的随机数传送带也不存在了，<strong>篡改传送带</strong>这个超能力也不能用！</p> <div class="custom-block warning"><p class="title"></p><p>但模拟器总要具备某种<strong>超能力</strong>，从而能够构建信任的<strong>根基</strong></p></div><p>（如果模拟器在没有超能力的情况下具备作弊能力，那相当于证明了协议的不可靠性）。</p> <p>可能大家现在已经猜出来了，模拟器要在<strong>随机预言机</strong>上动手脚。</p> <p>先考虑下构造一个<strong>理想世界</strong>来证明<strong>零知识</strong>。在理想世界中，模拟器<strong>绑架</strong>了负责提供预言的<strong>精灵</strong>。当 Bob 向精灵索要一个随机数的时候，精灵并没有给一个真随机数，而是给 Zlice（模拟器假扮的 Alice）提前准备好的一个数（也符合一致性分布，保证不可区分性），<strong>精灵</strong>无可奈何地返回 Bob 一个看起来随机，但实际上有后门的数字。<strong>所谓后门，就是这个数字是 Zlice 自己提前选择好的</strong>。</p> <p><img src="/assets/img/schnorrsig-sim1.f41b54dc.png" alt=""></p> <ol><li>Zlice 随机选择 <code>z</code>，随机选择 <code>c</code>，计算 <code>R'=z*G - c*PK</code>。</li></ol> <p><img src="/assets/img/schnorrsig-sim2.ef95b8ff.png" alt=""></p> <ol start="2"><li>Zlice 将 <code>c</code> 与 <code>(m, R')</code> 写入精灵的表格。</li></ol> <p><img src="/assets/img/schnorrsig-sim3.d3993152.png" alt=""></p> <ol start="3"><li>Zlice 将签名 <code>(c, z)</code> 发送给 Bob。</li></ol> <p><img src="/assets/img/schnorrsig-sim4.be5fc96f.png" alt=""></p> <ol start="4"><li>Bob 计算 <code>R = z*G - c*PK</code>，并向精灵发送 <code>(m, R)</code>，精灵返回 <code>c'</code>。请注意，这里 Bob 计算出来的 <code>R</code> 和 Zlice 计算出来的 <code>R'</code> 是相等。</li></ol> <p><img src="/assets/img/schnorrsig-sim5.01e97bcc.png" alt=""></p> <ol start="5"><li>Bob 验证 <code>c ?= c'</code>，看看精灵传回来的随机数和对方发过来的随机数是否相等。如果相等，则验证签名通过；否则验证失败。</li></ol> <p>通过绑架<strong>精灵</strong>，Zlice 同样可以提前预知随机数，这和时间倒流能达到同样的效果。</p> <p>我们已经证明了模拟器 Zlice 的<strong>存在性</strong>，于是证明了 NIZK。</p> <p>接下来我们证明这个这个协议的<strong>可靠性</strong>。设想在另一个<strong>理想世界</strong>中，一个叫做<strong>抽取器</strong>的玩意儿，也同样绑架了精灵。当无辜 Alice 的向<strong>精灵</strong>索要一个随机数时，<strong>精灵</strong>返回了一个 <code>c1</code>，<strong>抽取器</strong>从精灵的表格偷窥到了 <code>c1</code>。当 Alice 计算出来 <code>z1</code> 之后，然后这时候<strong>抽取器</strong>仍然可以发动<strong>时间倒流</strong>超能力，让 Alice 倒退到第二步，再次向<strong>精灵</strong>要一个随机数，Alice 发送的字符串显然和第一次发送的字符串是相同的，<code>(R, m)</code>。按道理，因为 <code>(R, m)</code> 已经写在精灵表格的<strong>左栏</strong>，所以一个诚实的<strong>精灵</strong>应该返回 <code>c1</code>。但是，<strong>抽取器</strong>绑架了精灵，他把表格中对应 <code>(R, m)</code> 这一行的<strong>右栏</strong>改成了一个不同的数 <code>c2</code>。当 Alice 计算出另一个 <code>z2</code> 之后，抽取器就完成了任务，通过下面的方程计算出 Alice 的私钥 <code>sk</code>：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sk = (z1 - z2)/(c1 - c2)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="fiat-shamir-变换-从-public-coin-到-nizk"><a href="#fiat-shamir-变换-从-public-coin-到-nizk" class="header-anchor">#</a> Fiat-Shamir 变换 -- 从 Public-Coin 到 NIZK</h2> <p>不仅仅对于 Schnorr 协议，对于任意的 <strong>Public-Coin 协议</strong>，都可以用 Fiat-Shamir 变换来把整个协议<strong>压缩</strong>成一步交互，也就是一个非交互式的证明系统，这个变换技巧最早来自于 Amos Fiat 与 Adi Shamir 两人的论文《How to Prove Yourself: Practical Solutions to Identification and Signature Problems》，发表在 1986 年的 Crypto 会议上 [5]。也有一说，这个技巧来源于 Manuel Blum [6]。</p> <p>重申一遍：在 Public-coin 协议中，验证者 Bob 只做一类事情，就是产生一个随机数，然后挑战 Alice 。通过 Fiat-Shamir 变换，可以把 Bob 每次的<strong>挑战行为</strong>用一次<strong>随机预言</strong>来代替。</p> <p>而在具体实现中，随机预言需要用一个具有密码学安全强度的哈希函数（不能随便选，一定要采用密码学安全的哈希），而哈希函数的参数应该是之前的所有上下文输入。下面是一个示例图，大家可以迅速理解这个 Fiat-Shamir 变换的做法。</p> <p><img src="/assets/img/fs-transform.b76ebadd.png" alt=""></p> <p>前面提到：非交互式证明系统需要引入一个第三方来构建信任的<strong>根基</strong>，使得 Bob 可以完全相信由 Alice 所构造的证明。在这里，第三方就是那个<strong>精灵</strong>，用学术黑话就是<strong>随机预言机</strong>（Random Oracle）。这个精灵并不是一个真实存在的第三方，而是一个虚拟的第三方，它同时存在于<strong>现实世界</strong>与<strong>理想世界</strong>。在<strong>现实世界</strong>中，精灵是一个负责任的安静美男子，而在<strong>理想世界</strong>中，它会被<strong>模拟器</strong>绑架。</p> <p>Public-Coin 协议还有一个好听的名字， <strong>Arthur-Merlin 游戏</strong> ......</p> <p><img src="/assets/img/arthur.c4f3fd3d.png" alt="圆桌骑士"></p> <p>如上图，左边的白袍就是 Merlin（魔法师梅林），中间拿剑的帅哥就是 King Arthur（亚瑟王）。两个角色来源于中世纪欧洲传说--亚瑟王的圆桌骑士。</p> <p>Arthur 是一个不耐烦的国王，他随身携带一个硬币，而 Merlin 是一个有着无限制计算能力的神奇魔法师。魔法师为了说服国王相信某个<strong>论断</strong>为真，会和国王进行到对话。但是国王比较懒，每次只会抛一个硬币，然后<strong>挑战</strong>魔法师，而魔法师不但需要及时应对，而且需要让国王在 k 轮之后能够相信自己的论断。由于 Merlin 有魔法，所以亚瑟王抛的硬币都能被 Merlin 看到 [7]。</p> <p>这与 <a href="/2021/02/14/zkp-01-intro/">初识零知识与证明</a> 提到的交互式证明系统（Interactive Proof System，简称 <code>IP</code>）有些神似，但又不同。<code>IP</code> 由 Goldwasser，Micali 与 Rackoff（简称 GMR）在 1985 年正式提出，它的证明能力覆盖很大一类的计算复杂性问题。而不同的地方在于：在 <code>IP</code> 的定义中，证明者 Prover 和 验证者 Verifier 都是可以抛硬币的图灵机，Verifier 可以偷偷抛硬币，并对 Prover 隐藏；而在 Arthur-Merlin 游戏中，国王只能抛硬币，不仅如此，而且抛硬币的结果总会被 Merlin 知道。</p> <p>但是，Fiat-Shamir 变换只能在<strong>随机预言机模型</strong>下证明安全，而用哈希函数实现随机预言的过程是否安全是缺少安全性证明的。不仅如此，<strong>随机预言机模型</strong>下安全的协议可能是不安全的，已经有人找到了一些反例 [8]。更不幸的是，S. Goldwasser 与 Y. Tauman 在 2003 年证明了 Fiat-Shamir 变换本身也是<strong>存在安全反例</strong>的 [9]。但是这并不意味着 Fiat-Shamir 变换不能用，只是使用过程要非常小心，不能盲目套用。</p> <p>尽管如此，人们无法抵挡 Fiat-Shamir 变换的诱惑，其使用极其广泛。值得一提的是，最热的通用非交互零知识证明 zkSNARK 的各种方案中，Fiat-Shamir 变换比比皆是。比如大家可能耳熟能详的 Bulletproofs（防弹证明），此外还有一些暂时还不那么有名的通用零知识证明方案，比如 Hyrax，Ligero，Supersonic，Libra 等（我们后续会抽丝剥茧，逐一解读）。</p> <h2 id="小心-fiat-shamir-变换的安全隐患"><a href="#小心-fiat-shamir-变换的安全隐患" class="header-anchor">#</a> 小心：Fiat-Shamir 变换的安全隐患</h2> <p>在 Fiat-Shamir 变换中，要尤其注意喂给哈希函数的参数，在实际的代码实现中，就有这样的案例，漏掉了哈希函数的部分参数：</p> <p>比如在 <code>A, Hash(A), B, Hash(B)</code> 中，第二个哈希函数就漏掉了参数 <code>A</code>，正确的做法应该是<code>A, Hash(A), B, Hash(A,B)</code>。这一类的做法会引入严重的安全漏洞，比如在瑞士的电子投票系统 SwissPost-Scytl 就在 Fiat-Shamir 变换的实现代码中多次漏掉了本来应该存在的参数，导致了攻击者不仅可以随意作废选票，还可以任意伪造选票，达到舞弊的目的 [10]。因此在工程实现中，请务必注意。</p> <p>细心读者也许会回看一下 Schnorr 签名，大家会发现 Schnorr 签名的哈希算法似乎也漏掉了一个参数 <code>PK</code>，并不是严格的 Fiat-Shamir 变换，这被称为 Weak Fiat-Shamir 变换 [11]，不过这个特例并没有安全问题[3]，请未成年人不要随意模仿。</p> <p>最近一些学者开始在标准模型下研究如何严格证明 Fiat-Shamir 变换的安全性，目前要么引入额外的强安全假设，要么针对某个特定协议进行证明，但似乎进展并不大。</p> <h2 id="交互的威力"><a href="#交互的威力" class="header-anchor">#</a> 交互的威力</h2> <p>话说在 1985 年，当 GMR 三人的论文历经多次被拒之后终于被 STOC'85 接受，另一篇类似的工作也同时被 STOC'85 接受，这就是来自于匈牙利罗兰大学的 László Babai与来自以色列理工的 Shlomo Moran 两人撰写的论文《Arthur-Merlin Games: A Randomized Proof System, and a Hierarchy of Complexity Classes》[7]，引入了 Public-coin 交互式协议（顾名思义，Verifier 只公开抛硬币）。</p> <p>国王 Arthur 的方法很简单，通过反复地<strong>随机</strong>挑战来检验 Merlin 的论断，这符合我们前面讲述过的直觉：采用随机挑战来构建信任的<strong>根基</strong>。Babai 在论文中证明了一个有趣的结论：<code>AM[k]=AM[2]</code>，其中 <code>k</code> 表示交互的次数，交互多次产生的效果居然和交互两次等价。所谓交互两次是指：Arthur 发一个挑战数，然后 Merlin 回应。</p> <blockquote><p>注：还有一类的问题属于 <code>MA</code>，这一类问题的交互顺序与 <code>AM</code> 不同。<code>MA</code> 中是 Merlin 先给出证明，然后 Arthur 抛硬币检验。已证明：MA 能处理的问题是 AM 的子集。</p></blockquote> <p>不仅如此，Babai 还大胆猜测： <code>AM[poly]</code> 与 <code>IP</code> 是等价的。这是一个神奇的论断：国王很懒，他只需要通过抛多项式次硬币，就能成功挑战魔法师，而这种方式的表达能力居然完全等价于 GMR 描述的交互式证明系统 <code>IP</code>。果不其然，在 STOC'86 会议上，来自 S. Goldwasser 与 M. Sipser 的论文证明了这一点--<code>AM[poly] == IP</code>[12]。</p> <p><img src="/assets/img/am-ip.9b1d5b11.png" alt=""></p> <p>这意味着：反复公开的<strong>随机挑战</strong>威力无穷，它等价于任意的交互式证明系统。但是 <code>AM[poly]</code> 和别的计算复杂性类的关系如何，是接下来的研究热点。</p> <p>三年后，1989 年 11 月底，距今恰好三十年，年轻的密码学家 Noam Nisan 发出了一封邮件，把自己的临时学术结论发给了几个密码学家，然后他就跑去南美洲度假了。可是他不曾想到，这一个邮件会引爆历史上一场激烈的学术竞赛，M. Blum, S. Kannan、D. Lipton、D. Beaver、J. Feigenbaum、H. Karloff 和 C. Lund 等等一大群精英开始加入战斗。他们没日没夜地互相讨论，并且竞相发布自己的研究成果，终于在 12 月 26 号，刚好一个月，Adi Shamir 证明了下面的结论：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>AM[poly] == IP == PSPACE
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/shamir.f1f30c4b.png" alt="image-shamir"></p> <p>它解释了<strong>有效证明</strong>这个概念的计算理论特征，并且解释了<strong>交互式证明系统</strong>这个概念所能涵盖的计算能力。</p> <blockquote><p>注：NP 类 是 PSPACE 类的子集，前者大家比较熟悉，后者关联游戏或者下棋中的制胜策略 [13]。</p></blockquote> <p>L. Babai 于是写了一篇文章，名为<strong>Email and the unexpected power of interaction</strong>（电子邮件与交互的始料未及的威力）[14]，详细阐述了这一整个月在<strong>邮件交互</strong>中精彩纷呈的学术竞赛，以及关于<strong>交互证明</strong>的来龙去脉。</p> <h2 id="公共参考串-另一种信任根基"><a href="#公共参考串-另一种信任根基" class="header-anchor">#</a> 公共参考串 -- 另一种<strong>信任根基</strong></h2> <p>除了采用<strong>随机预言机</strong>之外，非交互零知识证明系统采用<strong>公共参考串</strong>（Common Reference String），简称<strong>CRS</strong>，完成随机挑战。它是在证明者 Alice 在构造 NIZK 证明之前由一个受信任的第三方产生的随机字符串，CRS 必须由一个受信任的第三方来完成，同时共享给 Alice 和验证者 Bob。</p> <p>是的，这里又出现了<strong>第三方</strong>！虽然第三方不直接参与证明，但是他要保证随机字符串产生过程的可信。而产生 CRS 的过程也被称为<strong>Trusted Setup</strong>，这是大家又爱又恨的玩意儿。显然，在现实场景中引入第三方会让人头疼。CRS 到底用来作什么？Trusted Setup 的信任何去何从？这部分内容将留给本系列的下一篇。</p> <h2 id="未完待续"><a href="#未完待续" class="header-anchor">#</a> 未完待续</h2> <p>非交互式零知识证明 NIZK 的<strong>信任根基</strong>也需要某种形式的随机<strong>挑战</strong>。一种<strong>挑战</strong>形式是交给<strong>随机预言精灵</strong>；另一种<strong>挑战</strong>是通过 Alice 与 Bob 双方共享的随机字符串来实现。两种挑战形式本质上都引入了第三方，并且两者都必须提供可以让<strong>模拟器</strong>利用的<strong>后门</strong>，以使得模拟器在<strong>理想世界</strong>具有某种<strong>优势</strong>，而这种优势在<strong>现实世界</strong>必须失效。</p> <p>NIZK 散发着无穷魅力，让我不时惊叹，在过去三十多年里，先驱们所探寻到的精妙结论，同时还有如此之多的未知角落，在等待灵感之光的照射。</p> <p><em>致谢：特别感谢丁晟超，刘巍然，陈宇的专业建议和指正，感谢安比实验室小伙伴们(p0n1, even, aphasiayc, Vawheter, yghu, mr) 的修改建议。</em></p> <p><em>致谢：自 Nisan 发起的密码学研究轶事参考自邓老师的文章 [15]。</em></p> <h2 id="参考文献"><a href="#参考文献" class="header-anchor">#</a> 参考文献</h2> <ul><li>[1] Schnorr, Claus-Peter. &quot;Efficient signature generation by smart cards.&quot; Journal of cryptology 4.3 (1991): 161-174.</li> <li>[2] Paillier, Pascal, and Damien Vergnaud. &quot;Discrete-log-based signatures may not be equivalent to discrete log.&quot; <em>International Conference on the Theory and Application of Cryptology and Information Security</em>. Springer, Berlin, Heidelberg, 2005.</li> <li>[3] Pointcheval, David, and Jacques Stern. &quot;Security arguments for digital signatures and blind signatures.&quot; <em>Journal of cryptology</em> 13.3 (2000): 361-396.</li> <li>[4] Maxwell, Gregory, Andrew Poelstra, Yannick Seurin, and Pieter Wuille. &quot;Simple schnorr multi-signatures with applications to bitcoin.&quot; <em>Designs, Codes and Cryptography</em> 87, no. 9 (2019): 2139-2164.</li> <li>[5] Fiat, Amos, and Adi Shamir. &quot;How to prove yourself: Practical solutions to identification and signature problems.&quot; Conference on the Theory and Application of Cryptographic Techniques. Springer, Berlin, Heidelberg, 1986.</li> <li>[6] Bellare, Mihir, and Phillip Rogaway. &quot;Random Oracles Are Practical: a Paradigm for Designing Efficient Protocols.&quot; <em>Proc. of the 1st CCS</em> (1995): 62-73.</li> <li>[7] László Babai, and Shlomo Moran. &quot;Arthur-Merlin games: a randomized proof system, and a hierarchy of complexity classes.&quot; Journal of Computer and System Sciences 36.2 (1988): 254-276.m</li> <li>[8] Canetti, Ran, Oded Goldreich, and Shai Halevi. &quot;The random oracle methodology, revisited.&quot; Journal of the ACM (JACM)51.4 (2004): 557-594.</li> <li>[9] Shafi Goldwasser, and Yael Tauman . &quot;On the (in) security of the Fiat-Shamir paradigm.&quot; <em>44th Annual IEEE Symposium on Foundations of Computer Science, 2003. Proceedings.</em>. IEEE, 2003.</li> <li>[10]Lewis, Sarah Jamie, Olivier Pereira, and Vanessa Teague. &quot;Addendum to how not to prove your election outcome: The use of nonadaptive zero knowledge proofs in the ScytlSwissPost Internet voting system, and its implica tions for castasintended verifi cation.&quot; <em>Univ. Melbourne, Parkville, Australia</em> (2019).</li> <li>[11] Bernhard, David, Olivier Pereira, and Bogdan Warinschi. &quot;How not to prove yourself: Pitfalls of the fiat-shamir heuristic and applications to helios.&quot; <em>International Conference on the Theory and Application of Cryptology and Information Security</em>. Springer, Berlin, Heidelberg, 2012.</li> <li>[12] Goldwasser, Shafi, and Michael Sipser. &quot;Private coins versus public coins in interactive proof systems.&quot; <em>Proceedings of the eighteenth annual ACM symposium on Theory of computing</em>. ACM, 1986.</li> <li>[13] Papadimitriou, Christos H. &quot;Games against nature.&quot; <em>Journal of Computer and System Sciences</em> 31.2 (1985): 288-301.</li> <li>[14] Babai, László. &quot;E-mail and the unexpected power of interaction.&quot; <em>Proceedings Fifth Annual Structure in Complexity Theory Conference</em>. IEEE, 1990.</li> <li>[15] Yi Deng. &quot;零知识证明：一个略显严肃的科普.&quot; https://zhuanlan.zhihu.com/p/29491567</li></ul></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/24/2021, 1:18:34 AM</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/zkp/04-random-oracle/#交互与挑战" class="sidebar-link reco-side-交互与挑战" data-v-70334359>交互与挑战</a></li><li class="level-2" data-v-70334359><a href="/zkp/04-random-oracle/#非交互带来的困惑" class="sidebar-link reco-side-非交互带来的困惑" data-v-70334359>非交互带来的困惑</a></li><li class="level-2" data-v-70334359><a href="/zkp/04-random-oracle/#回顾-schnorr-协议" class="sidebar-link reco-side-回顾-schnorr-协议" data-v-70334359>回顾 Schnorr 协议</a></li><li class="level-2" data-v-70334359><a href="/zkp/04-random-oracle/#从-nizk-角度看数字签名" class="sidebar-link reco-side-从-nizk-角度看数字签名" data-v-70334359>从 NIZK 角度看数字签名</a></li><li class="level-2" data-v-70334359><a href="/zkp/04-random-oracle/#重建信任-随机预言精灵" class="sidebar-link reco-side-重建信任-随机预言精灵" data-v-70334359>重建信任 -- 随机预言精灵</a></li><li class="level-2" data-v-70334359><a href="/zkp/04-random-oracle/#构造根基-被绑架的精灵" class="sidebar-link reco-side-构造根基-被绑架的精灵" data-v-70334359>构造根基 -- 被绑架的精灵</a></li><li class="level-2" data-v-70334359><a href="/zkp/04-random-oracle/#fiat-shamir-变换-从-public-coin-到-nizk" class="sidebar-link reco-side-fiat-shamir-变换-从-public-coin-到-nizk" data-v-70334359>Fiat-Shamir 变换 -- 从 Public-Coin 到 NIZK</a></li><li class="level-2" data-v-70334359><a href="/zkp/04-random-oracle/#小心-fiat-shamir-变换的安全隐患" class="sidebar-link reco-side-小心-fiat-shamir-变换的安全隐患" data-v-70334359>小心：Fiat-Shamir 变换的安全隐患</a></li><li class="level-2" data-v-70334359><a href="/zkp/04-random-oracle/#交互的威力" class="sidebar-link reco-side-交互的威力" data-v-70334359>交互的威力</a></li><li class="level-2" data-v-70334359><a href="/zkp/04-random-oracle/#公共参考串-另一种信任根基" class="sidebar-link reco-side-公共参考串-另一种信任根基" data-v-70334359>公共参考串 -- 另一种信任根基</a></li><li class="level-2" data-v-70334359><a href="/zkp/04-random-oracle/#未完待续" class="sidebar-link reco-side-未完待续" data-v-70334359>未完待续</a></li><li class="level-2" data-v-70334359><a href="/zkp/04-random-oracle/#参考文献" class="sidebar-link reco-side-参考文献" data-v-70334359>参考文献</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.b0783623.js" defer></script><script src="/assets/js/3.3f52b992.js" defer></script><script src="/assets/js/1.86295094.js" defer></script><script src="/assets/js/13.42ab1ca0.js" defer></script>
  </body>
</html>
